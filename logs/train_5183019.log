2025-10-09 03:38:02 | INFO     | <module>:562 | === EHR Generation Training Started ===
2025-10-09 03:38:02 | INFO     | <module>:583 | Configuration: {'model_name': 'facebook/bart-base', 'num_patients': 3000, 'max_seq_length': 256, 'batch_size': 16, 'num_epochs': 30, 'learning_rate': 5e-05, 'generation_temp': 1.0, 'generation_max_length': 256, 'num_warmup_steps': 0, 'top_k': 30, 'data_dir': 'data_files', 'mimic_paths': {'patients_path': 'data_files/PATIENTS.csv', 'admissions_path': 'data_files/ADMISSIONS.csv', 'diagnoses_path': 'data_files/DIAGNOSES_ICD.csv'}}
2025-10-09 03:38:03 | INFO     | <module>:587 | Using device: cuda
2025-10-09 03:38:03 | INFO     | <module>:590 | Loading pretrained BART model: facebook/bart-base
2025-10-09 03:38:03 | INFO     | <module>:599 | Added 3 special tokens: <v>, <\v>, <END>
2025-10-09 03:38:03 | INFO     | <module>:603 | Resized model embeddings to 50268 tokens
2025-10-09 03:38:03 | DEBUG    | <module>:606 | Token ID for <v>: 50265
2025-10-09 03:38:03 | DEBUG    | <module>:607 | Token ID for <\v>: 50266
2025-10-09 03:38:03 | DEBUG    | <module>:608 | Token ID for <END>: 50267
2025-10-09 03:38:03 | INFO     | load_and_format_mimic_data:147 | Loading MIMIC-III data files
2025-10-09 03:38:03 | DEBUG    | load_and_format_mimic_data:148 | Patients: data_files/PATIENTS.csv
2025-10-09 03:38:03 | DEBUG    | load_and_format_mimic_data:149 | Admissions: data_files/ADMISSIONS.csv
2025-10-09 03:38:03 | DEBUG    | load_and_format_mimic_data:150 | Diagnoses: data_files/DIAGNOSES_ICD.csv
2025-10-09 03:38:03 | INFO     | load_and_format_mimic_data:155 | Loaded 46520 patients
2025-10-09 03:38:04 | INFO     | load_and_format_mimic_data:158 | Loaded 58976 admissions
2025-10-09 03:38:04 | INFO     | load_and_format_mimic_data:161 | Loaded 651047 diagnosis records
2025-10-09 03:38:04 | INFO     | load_and_format_mimic_data:219 | Data processing complete. Formatting sequences...
2025-10-09 03:38:07 | INFO     | load_and_format_mimic_data:258 | Sequence formatting complete. Generated 3000 patient sequences
2025-10-09 03:38:07 | DEBUG    | load_and_format_mimic_data:262 | Sample sequence: 0 ASIAN M <demo> <v> V3001 V053 V290 <\v> <END>...
2025-10-09 03:38:07 | INFO     | load_and_format_mimic_data:267 | Average visits per patient: 1.27
2025-10-09 03:38:07 | INFO     | load_and_format_mimic_data:268 | Average tokens per sequence: 19.69
2025-10-09 03:38:07 | INFO     | <module>:622 | Sample patient sequences:
2025-10-09 03:38:07 | INFO     | <module>:624 | Sample 1: 49 BLACK/AFRICAN AMERICAN M <demo> <v> 4168 4280 25040 40391 4240 41401 53081 <\v> <v> 4240 40391 5856 25001 3970 4280 53081 <\v> <END>...
2025-10-09 03:38:07 | INFO     | <module>:624 | Sample 2: 0 WHITE F <demo> <v> V3100 7742 76518 76527 7706 V290 V053 <\v> <END>...
2025-10-09 03:38:07 | INFO     | <module>:624 | Sample 3: 81 WHITE M <demo> <v> 4241 41401 4254 5990 2875 4111 25000 4019 2720 <\v> <END>...
2025-10-09 03:38:07 | INFO     | <module>:624 | Sample 4: 63 OTHER M <demo> <v> 5762 40391 5849 99811 2851 2867 51881 41400 V4581 <\v> <v> 5789 2765 2767 4589 5762 2859 25000 4019 5939 <\v> <v> 5723 53100 785...
2025-10-09 03:38:07 | INFO     | <module>:624 | Sample 5: 50 WHITE F <demo> <v> 80300 2765 30500 E9682 8730 311 412 <\v> <END>...
2025-10-09 03:38:07 | DEBUG    | __init__:294 | First sequence length: 24 tokens
2025-10-09 03:38:07 | DEBUG    | __init__:295 | Pad token ID: 1
2025-10-09 03:38:07 | INFO     | <module>:628 | Created dataset with 3000 samples, 188 batches
2025-10-09 03:38:07 | INFO     | <module>:639 | Optimizer: AdamW with lr=5e-05
2025-10-09 03:38:07 | INFO     | <module>:640 | Scheduler: linear with 0 warmup steps
2025-10-09 03:38:07 | INFO     | train_model:351 | Starting model training for 30 epochs
2025-10-09 03:38:07 | INFO     | train_model:352 | Training steps: 5640
2025-10-09 03:38:07 | INFO     | train_model:353 | Device: cuda
2025-10-09 03:38:07 | DEBUG    | train_model:372 | First batch input_ids shape: torch.Size([16, 256])
2025-10-09 03:38:07 | DEBUG    | train_model:373 | First batch labels shape: torch.Size([16, 256])
2025-10-09 03:38:07 | DEBUG    | train_model:374 | First batch attention_mask shape: torch.Size([16, 256])
2025-10-09 03:38:07 | DEBUG    | train_model:375 | Initial loss: 2.5943
2025-10-09 03:38:07 | DEBUG    | train_model:382 | Special tokens in first batch: {'pad': 3289, 'masked_labels': 3289}
2025-10-09 03:38:54 | INFO     | train_model:401 | Epoch 1/30 completed | Avg Loss: 0.6561
2025-10-09 03:39:40 | INFO     | train_model:401 | Epoch 2/30 completed | Avg Loss: 0.1110
2025-10-09 03:40:27 | INFO     | train_model:401 | Epoch 3/30 completed | Avg Loss: 0.0319
2025-10-09 03:41:14 | INFO     | train_model:401 | Epoch 4/30 completed | Avg Loss: 0.0134
2025-10-09 03:42:00 | INFO     | train_model:401 | Epoch 5/30 completed | Avg Loss: 0.0098
2025-10-09 03:42:47 | INFO     | train_model:401 | Epoch 6/30 completed | Avg Loss: 0.0111
2025-10-09 03:43:34 | INFO     | train_model:401 | Epoch 7/30 completed | Avg Loss: 0.0054
2025-10-09 03:44:20 | INFO     | train_model:401 | Epoch 8/30 completed | Avg Loss: 0.0052
2025-10-09 03:45:07 | INFO     | train_model:401 | Epoch 9/30 completed | Avg Loss: 0.0036
2025-10-09 03:45:53 | INFO     | train_model:401 | Epoch 10/30 completed | Avg Loss: 0.0038
2025-10-09 03:46:40 | INFO     | train_model:401 | Epoch 11/30 completed | Avg Loss: 0.0029
2025-10-09 03:47:27 | INFO     | train_model:401 | Epoch 12/30 completed | Avg Loss: 0.0030
2025-10-09 03:48:13 | INFO     | train_model:401 | Epoch 13/30 completed | Avg Loss: 0.0026
2025-10-09 03:49:00 | INFO     | train_model:401 | Epoch 14/30 completed | Avg Loss: 0.0014
2025-10-09 03:49:46 | INFO     | train_model:401 | Epoch 15/30 completed | Avg Loss: 0.0029
2025-10-09 03:50:33 | INFO     | train_model:401 | Epoch 16/30 completed | Avg Loss: 0.0014
2025-10-09 03:51:20 | INFO     | train_model:401 | Epoch 17/30 completed | Avg Loss: 0.0038
2025-10-09 03:52:06 | INFO     | train_model:401 | Epoch 18/30 completed | Avg Loss: 0.0022
2025-10-09 03:52:53 | INFO     | train_model:401 | Epoch 19/30 completed | Avg Loss: 0.0024
2025-10-09 03:53:39 | INFO     | train_model:401 | Epoch 20/30 completed | Avg Loss: 0.0020
2025-10-09 03:54:26 | INFO     | train_model:401 | Epoch 21/30 completed | Avg Loss: 0.0021
2025-10-09 03:55:13 | INFO     | train_model:401 | Epoch 22/30 completed | Avg Loss: 0.0007
2025-10-09 03:55:59 | INFO     | train_model:401 | Epoch 23/30 completed | Avg Loss: 0.0006
2025-10-09 03:56:46 | INFO     | train_model:401 | Epoch 24/30 completed | Avg Loss: 0.0021
2025-10-09 03:57:33 | INFO     | train_model:401 | Epoch 25/30 completed | Avg Loss: 0.0014
2025-10-09 03:58:19 | INFO     | train_model:401 | Epoch 26/30 completed | Avg Loss: 0.0008
2025-10-09 03:59:06 | INFO     | train_model:401 | Epoch 27/30 completed | Avg Loss: 0.0007
2025-10-09 03:59:52 | INFO     | train_model:401 | Epoch 28/30 completed | Avg Loss: 0.0002
2025-10-09 04:00:39 | INFO     | train_model:401 | Epoch 29/30 completed | Avg Loss: 0.0007
2025-10-09 04:01:26 | INFO     | train_model:401 | Epoch 30/30 completed | Avg Loss: 0.0004
2025-10-09 04:01:26 | INFO     | train_model:403 | Training complete
2025-10-09 04:01:26 | INFO     | train_model:404 | Final average loss: 0.0004
2025-10-09 04:01:26 | DEBUG    | train_model:405 | Loss history: [0.6560788362267169, 0.11104067963884866, 0.031899816931245176, 0.013423221227911083, 0.009761060495177245, 0.011070897285653119, 0.005366739273898581, 0.005206084659414742, 0.0036350722227151445, 0.0037733940971133475, 0.002887883912487094, 0.00302284508785654, 0.002649161547603224, 0.0014296151996259529, 0.002865113069500249, 0.0014167224512772357, 0.0037628188846939976, 0.0021946848602501052, 0.002397380426973154, 0.0020032844441494548, 0.0020680929522681486, 0.0007025828788445847, 0.0005683528409637337, 0.0021000145121395186, 0.0014410448185368837, 0.000764841140133943, 0.0007292091977433302, 0.00023448875757086616, 0.0006808403277899104, 0.0003685379021802912]
2025-10-09 04:01:26 | INFO     | <module>:654 | === Generating synthetic patient data ===
2025-10-09 04:01:26 | INFO     | <module>:663 | 
--- Sample 1/5 ---
2025-10-09 04:01:26 | INFO     | generate_patient_sequence:443 | Generating sequence for prompt: '31 HISPANIC OR LATINO F <demo>'
2025-10-09 04:01:26 | DEBUG    | generate_patient_sequence:447 | Prompt token IDs: [0, 2983, 37350, 510, 1889, 2371, 6532, 21455, 30535, 274, 28696, 12789, 139, 15698, 2]
2025-10-09 04:01:26 | DEBUG    | generate_patient_sequence:448 | Prompt tokens: ['<s>', '31', ' HIS', 'P', 'AN', 'IC', ' OR', ' LAT', 'INO', ' F', ' <', 'dem', 'o', '>', '</s>']
2025-10-09 04:01:26 | DEBUG    | generate_patient_sequence:457 | Special token IDs - <v>: 50265, <\v>: 50266, <END>: 50267, PAD: 1, EOS: 2
2025-10-09 04:01:26 | DEBUG    | generate_patient_sequence:464 | Initial decoder input (with forced <v>): [0, 2983, 37350, 510, 1889, 2371, 6532, 21455, 30535, 274, 28696, 12789, 139, 15698, 2, 50265]
2025-10-09 04:01:26 | DEBUG    | generate_patient_sequence:478 | After prompt, probability of <v>: 0.000006
2025-10-09 04:01:26 | DEBUG    | generate_patient_sequence:479 | After prompt, probability of <END>: 0.000006
2025-10-09 04:01:26 | DEBUG    | generate_patient_sequence:480 | After prompt, probability of PAD: 0.000000
2025-10-09 04:01:26 | DEBUG    | generate_patient_sequence:481 | After prompt, probability of EOS: 0.000021
2025-10-09 04:01:26 | DEBUG    | generate_patient_sequence:485 | Top 20 next token predictions after prompt:
2025-10-09 04:01:26 | DEBUG    | generate_patient_sequence:503 |   Rank 1: dem                  | Prob: 0.999868 | ID: 12789
2025-10-09 04:01:26 | DEBUG    | generate_patient_sequence:503 |   Rank 2:  DEM                 | Prob: 0.000057 | ID: 33474
2025-10-09 04:01:26 | DEBUG    | generate_patient_sequence:503 |   Rank 3: <EOS>                | Prob: 0.000021 | ID: 2
2025-10-09 04:01:26 | DEBUG    | generate_patient_sequence:503 |   Rank 4: Dem                  | Prob: 0.000015 | ID: 24658
2025-10-09 04:01:26 | DEBUG    | generate_patient_sequence:503 |   Rank 5: <END>                | Prob: 0.000006 | ID: 50267
2025-10-09 04:01:26 | DEBUG    | generate_patient_sequence:503 |   Rank 6: <v>                  | Prob: 0.000006 | ID: 50265
2025-10-09 04:01:26 | DEBUG    | generate_patient_sequence:503 |   Rank 7: DEM                  | Prob: 0.000005 | ID: 46128
2025-10-09 04:01:26 | DEBUG    | generate_patient_sequence:503 |   Rank 8: 2                    | Prob: 0.000003 | ID: 176
2025-10-09 04:01:26 | DEBUG    | generate_patient_sequence:503 |   Rank 9:  LAT                 | Prob: 0.000003 | ID: 21455
2025-10-09 04:01:26 | DEBUG    | generate_patient_sequence:503 |   Rank 10: >                    | Prob: 0.000001 | ID: 15698
2025-10-09 04:01:26 | DEBUG    | generate_patient_sequence:503 |   Rank 11: <\v>                 | Prob: 0.000001 | ID: 50266
2025-10-09 04:01:26 | DEBUG    | generate_patient_sequence:503 |   Rank 12: 3                    | Prob: 0.000001 | ID: 246
2025-10-09 04:01:26 | DEBUG    | generate_patient_sequence:503 |   Rank 13:  <                   | Prob: 0.000001 | ID: 28696
2025-10-09 04:01:26 | DEBUG    | generate_patient_sequence:503 |   Rank 14:  Dem                 | Prob: 0.000001 | ID: 5245
2025-10-09 04:01:26 | DEBUG    | generate_patient_sequence:503 |   Rank 15:  OTHER               | Prob: 0.000000 | ID: 16536
2025-10-09 04:01:26 | DEBUG    | generate_patient_sequence:503 |   Rank 16:  DEC                 | Prob: 0.000000 | ID: 16718
2025-10-09 04:01:26 | DEBUG    | generate_patient_sequence:503 |   Rank 17: NOT                  | Prob: 0.000000 | ID: 37049
2025-10-09 04:01:26 | DEBUG    | generate_patient_sequence:503 |   Rank 18:  F                   | Prob: 0.000000 | ID: 274
2025-10-09 04:01:26 | DEBUG    | generate_patient_sequence:503 |   Rank 19:                      | Prob: 0.000000 | ID: 1437
2025-10-09 04:01:26 | DEBUG    | generate_patient_sequence:503 |   Rank 20:  DES                 | Prob: 0.000000 | ID: 24566
2025-10-09 04:01:26 | INFO     | generate_patient_sequence:507 | Starting generation with temp=1.0, top_k=30, max_length=256
2025-10-09 04:01:26 | DEBUG    | generate_patient_sequence:520 | Generated token IDs: [2, 0, 2983, 37350, 510, 1889, 2371, 6532, 21455, 30535, 274, 28696, 12789, 139, 15698, 2, 50265, 274, 28696, 46128, 139, 15698, 1437, 50265, 2, 2, 50267]
2025-10-09 04:01:26 | DEBUG    | generate_patient_sequence:521 | Generated length: 27 tokens
2025-10-09 04:01:26 | INFO     | generate_patient_sequence:529 | Generated token counts - <v>: 2, <\v>: 0, <END>: 1
2025-10-09 04:01:26 | DEBUG    | generate_patient_sequence:537 | Raw generated sequence: </s><s>31 HISPANIC OR LATINO F <demo></s> <v>  F <DEMo>  <v> </s></s> <END>
2025-10-09 04:01:26 | INFO     | generate_patient_sequence:540 | Generated sequence (clean): 31 HISPANIC OR LATINO F <demo> F <DEMo> 
2025-10-09 04:01:26 | INFO     | <module>:663 | 
--- Sample 2/5 ---
2025-10-09 04:01:26 | INFO     | generate_patient_sequence:443 | Generating sequence for prompt: '35 BLACK M <demo>'
2025-10-09 04:01:26 | DEBUG    | generate_patient_sequence:447 | Prompt token IDs: [0, 2022, 34101, 256, 28696, 12789, 139, 15698, 2]
2025-10-09 04:01:26 | DEBUG    | generate_patient_sequence:448 | Prompt tokens: ['<s>', '35', ' BLACK', ' M', ' <', 'dem', 'o', '>', '</s>']
2025-10-09 04:01:26 | DEBUG    | generate_patient_sequence:457 | Special token IDs - <v>: 50265, <\v>: 50266, <END>: 50267, PAD: 1, EOS: 2
2025-10-09 04:01:26 | DEBUG    | generate_patient_sequence:464 | Initial decoder input (with forced <v>): [0, 2022, 34101, 256, 28696, 12789, 139, 15698, 2, 50265]
2025-10-09 04:01:26 | DEBUG    | generate_patient_sequence:478 | After prompt, probability of <v>: 0.000745
2025-10-09 04:01:26 | DEBUG    | generate_patient_sequence:479 | After prompt, probability of <END>: 0.001318
2025-10-09 04:01:26 | DEBUG    | generate_patient_sequence:480 | After prompt, probability of PAD: 0.000000
2025-10-09 04:01:26 | DEBUG    | generate_patient_sequence:481 | After prompt, probability of EOS: 0.009722
2025-10-09 04:01:26 | DEBUG    | generate_patient_sequence:485 | Top 20 next token predictions after prompt:
2025-10-09 04:01:26 | DEBUG    | generate_patient_sequence:503 |   Rank 1: dem                  | Prob: 0.938496 | ID: 12789
2025-10-09 04:01:26 | DEBUG    | generate_patient_sequence:503 |   Rank 2:  BLACK               | Prob: 0.035536 | ID: 34101
2025-10-09 04:01:26 | DEBUG    | generate_patient_sequence:503 |   Rank 3: <EOS>                | Prob: 0.009722 | ID: 2
2025-10-09 04:01:26 | DEBUG    | generate_patient_sequence:503 |   Rank 4:  WHITE               | Prob: 0.002256 | ID: 38503
2025-10-09 04:01:26 | DEBUG    | generate_patient_sequence:503 |   Rank 5: >                    | Prob: 0.001815 | ID: 15698
2025-10-09 04:01:26 | DEBUG    | generate_patient_sequence:503 |   Rank 6:  DEM                 | Prob: 0.001387 | ID: 33474
2025-10-09 04:01:26 | DEBUG    | generate_patient_sequence:503 |   Rank 7: <END>                | Prob: 0.001318 | ID: 50267
2025-10-09 04:01:26 | DEBUG    | generate_patient_sequence:503 |   Rank 8:  <                   | Prob: 0.001280 | ID: 28696
2025-10-09 04:01:26 | DEBUG    | generate_patient_sequence:503 |   Rank 9: <v>                  | Prob: 0.000745 | ID: 50265
2025-10-09 04:01:26 | DEBUG    | generate_patient_sequence:503 |   Rank 10:  OTHER               | Prob: 0.000626 | ID: 16536
2025-10-09 04:01:26 | DEBUG    | generate_patient_sequence:503 |   Rank 11:  F                   | Prob: 0.000390 | ID: 274
2025-10-09 04:01:26 | DEBUG    | generate_patient_sequence:503 |   Rank 12:  401                 | Prob: 0.000377 | ID: 17936
2025-10-09 04:01:26 | DEBUG    | generate_patient_sequence:503 |   Rank 13: <\v>                 | Prob: 0.000201 | ID: 50266
2025-10-09 04:01:26 | DEBUG    | generate_patient_sequence:503 |   Rank 14: 2                    | Prob: 0.000180 | ID: 176
2025-10-09 04:01:26 | DEBUG    | generate_patient_sequence:503 |   Rank 15: >.                   | Prob: 0.000129 | ID: 48691
2025-10-09 04:01:26 | DEBUG    | generate_patient_sequence:503 |   Rank 16:  LAT                 | Prob: 0.000126 | ID: 21455
2025-10-09 04:01:26 | DEBUG    | generate_patient_sequence:503 |   Rank 17: 3                    | Prob: 0.000124 | ID: 246
2025-10-09 04:01:26 | DEBUG    | generate_patient_sequence:503 |   Rank 18:  M                   | Prob: 0.000112 | ID: 256
2025-10-09 04:01:26 | DEBUG    | generate_patient_sequence:503 |   Rank 19:  ?                   | Prob: 0.000107 | ID: 17487
2025-10-09 04:01:26 | DEBUG    | generate_patient_sequence:503 |   Rank 20:                      | Prob: 0.000100 | ID: 1437
2025-10-09 04:01:26 | INFO     | generate_patient_sequence:507 | Starting generation with temp=1.0, top_k=30, max_length=256
2025-10-09 04:01:26 | DEBUG    | generate_patient_sequence:520 | Generated token IDs: [2, 0, 2022, 34101, 256, 28696, 12789, 139, 15698, 2, 50265, 15698, 2, 38503, 256, 28696, 24658, 139, 15698, 1437, 50265, 2, 2, 50266, 15698, 2, 50267]
2025-10-09 04:01:26 | DEBUG    | generate_patient_sequence:521 | Generated length: 27 tokens
2025-10-09 04:01:26 | INFO     | generate_patient_sequence:529 | Generated token counts - <v>: 2, <\v>: 1, <END>: 1
2025-10-09 04:01:26 | DEBUG    | generate_patient_sequence:537 | Raw generated sequence: </s><s>35 BLACK M <demo></s> <v> ></s> WHITE M <Demo>  <v> </s></s> <\v> ></s> <END>
2025-10-09 04:01:26 | INFO     | generate_patient_sequence:540 | Generated sequence (clean): 35 BLACK M <demo>> WHITE M <Demo> >
2025-10-09 04:01:26 | INFO     | <module>:663 | 
--- Sample 3/5 ---
2025-10-09 04:01:26 | INFO     | generate_patient_sequence:443 | Generating sequence for prompt: '41 BLACK F <demo>'
2025-10-09 04:01:26 | DEBUG    | generate_patient_sequence:447 | Prompt token IDs: [0, 4006, 34101, 274, 28696, 12789, 139, 15698, 2]
2025-10-09 04:01:26 | DEBUG    | generate_patient_sequence:448 | Prompt tokens: ['<s>', '41', ' BLACK', ' F', ' <', 'dem', 'o', '>', '</s>']
2025-10-09 04:01:26 | DEBUG    | generate_patient_sequence:457 | Special token IDs - <v>: 50265, <\v>: 50266, <END>: 50267, PAD: 1, EOS: 2
2025-10-09 04:01:26 | DEBUG    | generate_patient_sequence:464 | Initial decoder input (with forced <v>): [0, 4006, 34101, 274, 28696, 12789, 139, 15698, 2, 50265]
2025-10-09 04:01:26 | DEBUG    | generate_patient_sequence:478 | After prompt, probability of <v>: 0.000015
2025-10-09 04:01:26 | DEBUG    | generate_patient_sequence:479 | After prompt, probability of <END>: 0.000024
2025-10-09 04:01:26 | DEBUG    | generate_patient_sequence:480 | After prompt, probability of PAD: 0.000000
2025-10-09 04:01:26 | DEBUG    | generate_patient_sequence:481 | After prompt, probability of EOS: 0.000139
2025-10-09 04:01:26 | DEBUG    | generate_patient_sequence:485 | Top 20 next token predictions after prompt:
2025-10-09 04:01:26 | DEBUG    | generate_patient_sequence:503 |   Rank 1:  BLACK               | Prob: 0.997820 | ID: 34101
2025-10-09 04:01:26 | DEBUG    | generate_patient_sequence:503 |   Rank 2:  WHITE               | Prob: 0.001216 | ID: 38503
2025-10-09 04:01:26 | DEBUG    | generate_patient_sequence:503 |   Rank 3:  OTHER               | Prob: 0.000142 | ID: 16536
2025-10-09 04:01:26 | DEBUG    | generate_patient_sequence:503 |   Rank 4: <EOS>                | Prob: 0.000139 | ID: 2
2025-10-09 04:01:26 | DEBUG    | generate_patient_sequence:503 |   Rank 5: dem                  | Prob: 0.000119 | ID: 12789
2025-10-09 04:01:26 | DEBUG    | generate_patient_sequence:503 |   Rank 6:  F                   | Prob: 0.000085 | ID: 274
2025-10-09 04:01:26 | DEBUG    | generate_patient_sequence:503 |   Rank 7: >                    | Prob: 0.000046 | ID: 15698
2025-10-09 04:01:26 | DEBUG    | generate_patient_sequence:503 |   Rank 8: <END>                | Prob: 0.000024 | ID: 50267
2025-10-09 04:01:26 | DEBUG    | generate_patient_sequence:503 |   Rank 9:  401                 | Prob: 0.000021 | ID: 17936
2025-10-09 04:01:26 | DEBUG    | generate_patient_sequence:503 |   Rank 10:  <                   | Prob: 0.000019 | ID: 28696
2025-10-09 04:01:26 | DEBUG    | generate_patient_sequence:503 |   Rank 11: <v>                  | Prob: 0.000015 | ID: 50265
2025-10-09 04:01:26 | DEBUG    | generate_patient_sequence:503 |   Rank 12:  DEM                 | Prob: 0.000015 | ID: 33474
2025-10-09 04:01:26 | DEBUG    | generate_patient_sequence:503 |   Rank 13:  NAT                 | Prob: 0.000010 | ID: 36233
2025-10-09 04:01:26 | DEBUG    | generate_patient_sequence:503 |   Rank 14:                      | Prob: 0.000008 | ID: 1437
2025-10-09 04:01:26 | DEBUG    | generate_patient_sequence:503 |   Rank 15:  PU                  | Prob: 0.000007 | ID: 29731
2025-10-09 04:01:26 | DEBUG    | generate_patient_sequence:503 |   Rank 16:  SPORTS              | Prob: 0.000007 | ID: 22204
2025-10-09 04:01:26 | DEBUG    | generate_patient_sequence:503 |   Rank 17:  OR                  | Prob: 0.000007 | ID: 6532
2025-10-09 04:01:26 | DEBUG    | generate_patient_sequence:503 |   Rank 18: <\v>                 | Prob: 0.000007 | ID: 50266
2025-10-09 04:01:26 | DEBUG    | generate_patient_sequence:503 |   Rank 19:  PUBLIC              | Prob: 0.000006 | ID: 28718
2025-10-09 04:01:26 | DEBUG    | generate_patient_sequence:503 |   Rank 20:  LAT                 | Prob: 0.000006 | ID: 21455
2025-10-09 04:01:26 | INFO     | generate_patient_sequence:507 | Starting generation with temp=1.0, top_k=30, max_length=256
2025-10-09 04:01:26 | DEBUG    | generate_patient_sequence:520 | Generated token IDs: [2, 0, 4006, 34101, 274, 28696, 12789, 139, 15698, 2, 50265, 2, 2, 50267]
2025-10-09 04:01:26 | DEBUG    | generate_patient_sequence:521 | Generated length: 14 tokens
2025-10-09 04:01:26 | INFO     | generate_patient_sequence:529 | Generated token counts - <v>: 1, <\v>: 0, <END>: 1
2025-10-09 04:01:26 | DEBUG    | generate_patient_sequence:537 | Raw generated sequence: </s><s>41 BLACK F <demo></s> <v> </s></s> <END>
2025-10-09 04:01:26 | INFO     | generate_patient_sequence:540 | Generated sequence (clean): 41 BLACK F <demo>
2025-10-09 04:01:26 | INFO     | <module>:663 | 
--- Sample 4/5 ---
2025-10-09 04:01:26 | INFO     | generate_patient_sequence:443 | Generating sequence for prompt: '83 WHITE M <demo>'
2025-10-09 04:01:26 | DEBUG    | generate_patient_sequence:447 | Prompt token IDs: [0, 6361, 38503, 256, 28696, 12789, 139, 15698, 2]
2025-10-09 04:01:26 | DEBUG    | generate_patient_sequence:448 | Prompt tokens: ['<s>', '83', ' WHITE', ' M', ' <', 'dem', 'o', '>', '</s>']
2025-10-09 04:01:26 | DEBUG    | generate_patient_sequence:457 | Special token IDs - <v>: 50265, <\v>: 50266, <END>: 50267, PAD: 1, EOS: 2
2025-10-09 04:01:26 | DEBUG    | generate_patient_sequence:464 | Initial decoder input (with forced <v>): [0, 6361, 38503, 256, 28696, 12789, 139, 15698, 2, 50265]
2025-10-09 04:01:26 | DEBUG    | generate_patient_sequence:478 | After prompt, probability of <v>: 0.000069
2025-10-09 04:01:26 | DEBUG    | generate_patient_sequence:479 | After prompt, probability of <END>: 0.000135
2025-10-09 04:01:26 | DEBUG    | generate_patient_sequence:480 | After prompt, probability of PAD: 0.000000
2025-10-09 04:01:26 | DEBUG    | generate_patient_sequence:481 | After prompt, probability of EOS: 0.001656
2025-10-09 04:01:26 | DEBUG    | generate_patient_sequence:485 | Top 20 next token predictions after prompt:
2025-10-09 04:01:26 | DEBUG    | generate_patient_sequence:503 |   Rank 1: dem                  | Prob: 0.997032 | ID: 12789
2025-10-09 04:01:26 | DEBUG    | generate_patient_sequence:503 |   Rank 2: <EOS>                | Prob: 0.001656 | ID: 2
2025-10-09 04:01:26 | DEBUG    | generate_patient_sequence:503 |   Rank 3: >                    | Prob: 0.000318 | ID: 15698
2025-10-09 04:01:26 | DEBUG    | generate_patient_sequence:503 |   Rank 4:  <                   | Prob: 0.000155 | ID: 28696
2025-10-09 04:01:26 | DEBUG    | generate_patient_sequence:503 |   Rank 5: <END>                | Prob: 0.000135 | ID: 50267
2025-10-09 04:01:26 | DEBUG    | generate_patient_sequence:503 |   Rank 6:  DEM                 | Prob: 0.000079 | ID: 33474
2025-10-09 04:01:26 | DEBUG    | generate_patient_sequence:503 |   Rank 7: 2                    | Prob: 0.000077 | ID: 176
2025-10-09 04:01:26 | DEBUG    | generate_patient_sequence:503 |   Rank 8: <v>                  | Prob: 0.000069 | ID: 50265
2025-10-09 04:01:26 | DEBUG    | generate_patient_sequence:503 |   Rank 9: Dem                  | Prob: 0.000040 | ID: 24658
2025-10-09 04:01:26 | DEBUG    | generate_patient_sequence:503 |   Rank 10: 3                    | Prob: 0.000031 | ID: 246
2025-10-09 04:01:26 | DEBUG    | generate_patient_sequence:503 |   Rank 11:  WHITE               | Prob: 0.000022 | ID: 38503
2025-10-09 04:01:26 | DEBUG    | generate_patient_sequence:503 |   Rank 12:  ?                   | Prob: 0.000012 | ID: 17487
2025-10-09 04:01:26 | DEBUG    | generate_patient_sequence:503 |   Rank 13: <\v>                 | Prob: 0.000011 | ID: 50266
2025-10-09 04:01:26 | DEBUG    | generate_patient_sequence:503 |   Rank 14:  OTHER               | Prob: 0.000011 | ID: 16536
2025-10-09 04:01:26 | DEBUG    | generate_patient_sequence:503 |   Rank 15:                      | Prob: 0.000010 | ID: 1437
2025-10-09 04:01:26 | DEBUG    | generate_patient_sequence:503 |   Rank 16:  F                   | Prob: 0.000008 | ID: 274
2025-10-09 04:01:26 | DEBUG    | generate_patient_sequence:503 |   Rank 17: 0                    | Prob: 0.000007 | ID: 288
2025-10-09 04:01:26 | DEBUG    | generate_patient_sequence:503 |   Rank 18:  401                 | Prob: 0.000006 | ID: 17936
2025-10-09 04:01:26 | DEBUG    | generate_patient_sequence:503 |   Rank 19:  >                   | Prob: 0.000006 | ID: 8061
2025-10-09 04:01:26 | DEBUG    | generate_patient_sequence:503 |   Rank 20: DEM                  | Prob: 0.000006 | ID: 46128
2025-10-09 04:01:26 | INFO     | generate_patient_sequence:507 | Starting generation with temp=1.0, top_k=30, max_length=256
2025-10-09 04:01:26 | DEBUG    | generate_patient_sequence:520 | Generated token IDs: [2, 0, 6361, 38503, 256, 28696, 12789, 139, 15698, 2, 50265, 15698, 2, 2, 12789, 139, 8061, 2, 50265, 2, 2, 50267]
2025-10-09 04:01:26 | DEBUG    | generate_patient_sequence:521 | Generated length: 22 tokens
2025-10-09 04:01:26 | INFO     | generate_patient_sequence:529 | Generated token counts - <v>: 2, <\v>: 0, <END>: 1
2025-10-09 04:01:26 | DEBUG    | generate_patient_sequence:537 | Raw generated sequence: </s><s>83 WHITE M <demo></s> <v> ></s></s>demo ></s> <v> </s></s> <END>
2025-10-09 04:01:26 | INFO     | generate_patient_sequence:540 | Generated sequence (clean): 83 WHITE M <demo>>demo >
2025-10-09 04:01:26 | INFO     | <module>:663 | 
--- Sample 5/5 ---
2025-10-09 04:01:26 | INFO     | generate_patient_sequence:443 | Generating sequence for prompt: '38 UNKNOWN/NOT SPECIFIED M <demo>'
2025-10-09 04:01:26 | DEBUG    | generate_patient_sequence:447 | Prompt token IDs: [0, 3170, 2604, 47300, 73, 37049, 44921, 36482, 256, 28696, 12789, 139, 15698, 2]
2025-10-09 04:01:26 | DEBUG    | generate_patient_sequence:448 | Prompt tokens: ['<s>', '38', ' UN', 'KNOWN', '/', 'NOT', ' SPEC', 'IFIED', ' M', ' <', 'dem', 'o', '>', '</s>']
2025-10-09 04:01:26 | DEBUG    | generate_patient_sequence:457 | Special token IDs - <v>: 50265, <\v>: 50266, <END>: 50267, PAD: 1, EOS: 2
2025-10-09 04:01:26 | DEBUG    | generate_patient_sequence:464 | Initial decoder input (with forced <v>): [0, 3170, 2604, 47300, 73, 37049, 44921, 36482, 256, 28696, 12789, 139, 15698, 2, 50265]
2025-10-09 04:01:26 | DEBUG    | generate_patient_sequence:478 | After prompt, probability of <v>: 0.000007
2025-10-09 04:01:26 | DEBUG    | generate_patient_sequence:479 | After prompt, probability of <END>: 0.000005
2025-10-09 04:01:26 | DEBUG    | generate_patient_sequence:480 | After prompt, probability of PAD: 0.000000
2025-10-09 04:01:26 | DEBUG    | generate_patient_sequence:481 | After prompt, probability of EOS: 0.000064
2025-10-09 04:01:26 | DEBUG    | generate_patient_sequence:485 | Top 20 next token predictions after prompt:
2025-10-09 04:01:26 | DEBUG    | generate_patient_sequence:503 |   Rank 1: dem                  | Prob: 0.999789 | ID: 12789
2025-10-09 04:01:26 | DEBUG    | generate_patient_sequence:503 |   Rank 2: <EOS>                | Prob: 0.000064 | ID: 2
2025-10-09 04:01:26 | DEBUG    | generate_patient_sequence:503 |   Rank 3:  DEM                 | Prob: 0.000058 | ID: 33474
2025-10-09 04:01:26 | DEBUG    | generate_patient_sequence:503 |   Rank 4: Dem                  | Prob: 0.000015 | ID: 24658
2025-10-09 04:01:26 | DEBUG    | generate_patient_sequence:503 |   Rank 5:  <                   | Prob: 0.000012 | ID: 28696
2025-10-09 04:01:26 | DEBUG    | generate_patient_sequence:503 |   Rank 6: >                    | Prob: 0.000012 | ID: 15698
2025-10-09 04:01:26 | DEBUG    | generate_patient_sequence:503 |   Rank 7: <v>                  | Prob: 0.000007 | ID: 50265
2025-10-09 04:01:26 | DEBUG    | generate_patient_sequence:503 |   Rank 8: <END>                | Prob: 0.000005 | ID: 50267
2025-10-09 04:01:26 | DEBUG    | generate_patient_sequence:503 |   Rank 9: 2                    | Prob: 0.000003 | ID: 176
2025-10-09 04:01:26 | DEBUG    | generate_patient_sequence:503 |   Rank 10: NOT                  | Prob: 0.000003 | ID: 37049
2025-10-09 04:01:26 | DEBUG    | generate_patient_sequence:503 |   Rank 11:  Dem                 | Prob: 0.000002 | ID: 5245
2025-10-09 04:01:26 | DEBUG    | generate_patient_sequence:503 |   Rank 12: DEM                  | Prob: 0.000002 | ID: 46128
2025-10-09 04:01:26 | DEBUG    | generate_patient_sequence:503 |   Rank 13:  ?                   | Prob: 0.000002 | ID: 17487
2025-10-09 04:01:26 | DEBUG    | generate_patient_sequence:503 |   Rank 14:  DES                 | Prob: 0.000001 | ID: 24566
2025-10-09 04:01:26 | DEBUG    | generate_patient_sequence:503 |   Rank 15: <\v>                 | Prob: 0.000001 | ID: 50266
2025-10-09 04:01:26 | DEBUG    | generate_patient_sequence:503 |   Rank 16:  OTHER               | Prob: 0.000001 | ID: 16536
2025-10-09 04:01:26 | DEBUG    | generate_patient_sequence:503 |   Rank 17:  M                   | Prob: 0.000001 | ID: 256
2025-10-09 04:01:26 | DEBUG    | generate_patient_sequence:503 |   Rank 18: 3                    | Prob: 0.000001 | ID: 246
2025-10-09 04:01:26 | DEBUG    | generate_patient_sequence:503 |   Rank 19:                      | Prob: 0.000001 | ID: 1437
2025-10-09 04:01:26 | DEBUG    | generate_patient_sequence:503 |   Rank 20: ?                    | Prob: 0.000001 | ID: 116
2025-10-09 04:01:26 | INFO     | generate_patient_sequence:507 | Starting generation with temp=1.0, top_k=30, max_length=256
2025-10-09 04:01:26 | DEBUG    | generate_patient_sequence:520 | Generated token IDs: [2, 0, 3170, 2604, 47300, 73, 37049, 44921, 36482, 256, 28696, 12789, 139, 15698, 2, 50265, 15698, 2, 12789, 139, 8061, 2, 2, 50266, 15698, 2, 50266, 2, 2, 50267]
2025-10-09 04:01:26 | DEBUG    | generate_patient_sequence:521 | Generated length: 30 tokens
2025-10-09 04:01:26 | INFO     | generate_patient_sequence:529 | Generated token counts - <v>: 1, <\v>: 2, <END>: 1
2025-10-09 04:01:26 | DEBUG    | generate_patient_sequence:537 | Raw generated sequence: </s><s>38 UNKNOWN/NOT SPECIFIED M <demo></s> <v> ></s>demo ></s></s> <\v> ></s> <\v> </s></s> <END>
2025-10-09 04:01:26 | INFO     | generate_patient_sequence:540 | Generated sequence (clean): 38 UNKNOWN/NOT SPECIFIED M <demo>>demo >>
2025-10-09 04:01:26 | INFO     | <module>:677 | === Training and generation complete ===
