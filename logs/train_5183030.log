2025-10-09 04:48:55 | INFO     | <module>:562 | === EHR Generation Training Started ===
2025-10-09 04:48:55 | INFO     | <module>:583 | Configuration: {'model_name': 'facebook/bart-base', 'num_patients': 3000, 'max_seq_length': 256, 'batch_size': 16, 'num_epochs': 30, 'learning_rate': 0.0002, 'generation_temp': 1.0, 'generation_max_length': 256, 'num_warmup_steps': 0, 'top_k': 100, 'data_dir': 'data_files', 'mimic_paths': {'patients_path': 'data_files/PATIENTS.csv', 'admissions_path': 'data_files/ADMISSIONS.csv', 'diagnoses_path': 'data_files/DIAGNOSES_ICD.csv'}}
2025-10-09 04:48:55 | INFO     | <module>:587 | Using device: cuda
2025-10-09 04:48:55 | INFO     | <module>:590 | Loading pretrained BART model: facebook/bart-base
2025-10-09 04:48:56 | INFO     | <module>:599 | Added 3 special tokens: <v>, <\v>, <END>
2025-10-09 04:48:57 | INFO     | <module>:603 | Resized model embeddings to 50268 tokens
2025-10-09 04:48:57 | DEBUG    | <module>:606 | Token ID for <v>: 50265
2025-10-09 04:48:57 | DEBUG    | <module>:607 | Token ID for <\v>: 50266
2025-10-09 04:48:57 | DEBUG    | <module>:608 | Token ID for <END>: 50267
2025-10-09 04:48:57 | INFO     | load_and_format_mimic_data:147 | Loading MIMIC-III data files
2025-10-09 04:48:57 | DEBUG    | load_and_format_mimic_data:148 | Patients: data_files/PATIENTS.csv
2025-10-09 04:48:57 | DEBUG    | load_and_format_mimic_data:149 | Admissions: data_files/ADMISSIONS.csv
2025-10-09 04:48:57 | DEBUG    | load_and_format_mimic_data:150 | Diagnoses: data_files/DIAGNOSES_ICD.csv
2025-10-09 04:48:57 | INFO     | load_and_format_mimic_data:155 | Loaded 46520 patients
2025-10-09 04:48:57 | INFO     | load_and_format_mimic_data:158 | Loaded 58976 admissions
2025-10-09 04:48:57 | INFO     | load_and_format_mimic_data:161 | Loaded 651047 diagnosis records
2025-10-09 04:48:57 | INFO     | load_and_format_mimic_data:219 | Data processing complete. Formatting sequences...
2025-10-09 04:49:00 | INFO     | load_and_format_mimic_data:258 | Sequence formatting complete. Generated 3000 patient sequences
2025-10-09 04:49:00 | DEBUG    | load_and_format_mimic_data:262 | Sample sequence: 0 ASIAN M <demo> <v> V3001 V053 V290 <\v> <END>...
2025-10-09 04:49:00 | INFO     | load_and_format_mimic_data:267 | Average visits per patient: 1.27
2025-10-09 04:49:00 | INFO     | load_and_format_mimic_data:268 | Average tokens per sequence: 19.69
2025-10-09 04:49:00 | INFO     | <module>:622 | Sample patient sequences:
2025-10-09 04:49:00 | INFO     | <module>:624 | Sample 1: 0 WHITE F <demo> <v> V3000 V053 V290 <\v> <END>...
2025-10-09 04:49:00 | INFO     | <module>:624 | Sample 2: 90 WHITE M <demo> <v> 03842 5849 78552 5990 27652 00845 2762 2760 2875 70703 99592 V0980 V1051 3310 29410 60001 2768 03849 <\v> <END>...
2025-10-09 04:49:00 | INFO     | <module>:624 | Sample 3: 0 WHITE M <demo> <v> V3000 V053 <\v> <END>...
2025-10-09 04:49:00 | INFO     | <module>:624 | Sample 4: 43 WHITE F <demo> <v> 1983 1625 3051 <\v> <v> 1625 5121 1961 99702 9973 5180 2760 V1085 5110 <\v> <END>...
2025-10-09 04:49:00 | INFO     | <module>:624 | Sample 5: 81 UNKNOWN/NOT SPECIFIED M <demo> <v> 515 5845 51881 2760 5121 5990 4280 29281 3594 <\v> <END>...
2025-10-09 04:49:00 | DEBUG    | __init__:294 | First sequence length: 24 tokens
2025-10-09 04:49:00 | DEBUG    | __init__:295 | Pad token ID: 1
2025-10-09 04:49:00 | INFO     | <module>:628 | Created dataset with 3000 samples, 188 batches
2025-10-09 04:49:00 | INFO     | <module>:639 | Optimizer: AdamW with lr=0.0002
2025-10-09 04:49:00 | INFO     | <module>:640 | Scheduler: linear with 0 warmup steps
2025-10-09 04:49:00 | INFO     | train_model:351 | Starting model training for 30 epochs
2025-10-09 04:49:00 | INFO     | train_model:352 | Training steps: 5640
2025-10-09 04:49:00 | INFO     | train_model:353 | Device: cuda
2025-10-09 04:49:01 | DEBUG    | train_model:372 | First batch input_ids shape: torch.Size([16, 256])
2025-10-09 04:49:01 | DEBUG    | train_model:373 | First batch labels shape: torch.Size([16, 256])
2025-10-09 04:49:01 | DEBUG    | train_model:374 | First batch attention_mask shape: torch.Size([16, 256])
2025-10-09 04:49:01 | DEBUG    | train_model:375 | Initial loss: 2.4758
2025-10-09 04:49:01 | DEBUG    | train_model:382 | Special tokens in first batch: {'pad': 3483, 'masked_labels': 3483}
2025-10-09 04:49:47 | INFO     | train_model:401 | Epoch 1/30 completed | Avg Loss: 0.4574
2025-10-09 04:50:34 | INFO     | train_model:401 | Epoch 2/30 completed | Avg Loss: 0.0239
2025-10-09 04:51:20 | INFO     | train_model:401 | Epoch 3/30 completed | Avg Loss: 0.0308
2025-10-09 04:52:07 | INFO     | train_model:401 | Epoch 4/30 completed | Avg Loss: 0.0196
2025-10-09 04:52:53 | INFO     | train_model:401 | Epoch 5/30 completed | Avg Loss: 0.0535
2025-10-09 04:53:40 | INFO     | train_model:401 | Epoch 6/30 completed | Avg Loss: 0.0285
2025-10-09 04:54:27 | INFO     | train_model:401 | Epoch 7/30 completed | Avg Loss: 0.0144
2025-10-09 04:55:13 | INFO     | train_model:401 | Epoch 8/30 completed | Avg Loss: 0.0111
2025-10-09 04:56:00 | INFO     | train_model:401 | Epoch 9/30 completed | Avg Loss: 0.0155
2025-10-09 04:56:46 | INFO     | train_model:401 | Epoch 10/30 completed | Avg Loss: 0.0181
2025-10-09 04:57:33 | INFO     | train_model:401 | Epoch 11/30 completed | Avg Loss: 0.0422
2025-10-09 04:58:20 | INFO     | train_model:401 | Epoch 12/30 completed | Avg Loss: 0.0182
2025-10-09 04:59:06 | INFO     | train_model:401 | Epoch 13/30 completed | Avg Loss: 0.0077
2025-10-09 04:59:53 | INFO     | train_model:401 | Epoch 14/30 completed | Avg Loss: 0.0084
2025-10-09 05:00:40 | INFO     | train_model:401 | Epoch 15/30 completed | Avg Loss: 0.0036
2025-10-09 05:01:26 | INFO     | train_model:401 | Epoch 16/30 completed | Avg Loss: 0.0043
2025-10-09 05:02:13 | INFO     | train_model:401 | Epoch 17/30 completed | Avg Loss: 0.0049
2025-10-09 05:02:59 | INFO     | train_model:401 | Epoch 18/30 completed | Avg Loss: 0.0239
2025-10-09 05:03:46 | INFO     | train_model:401 | Epoch 19/30 completed | Avg Loss: 0.0057
2025-10-09 05:04:33 | INFO     | train_model:401 | Epoch 20/30 completed | Avg Loss: 0.0094
2025-10-09 05:05:19 | INFO     | train_model:401 | Epoch 21/30 completed | Avg Loss: 0.0051
2025-10-09 05:06:06 | INFO     | train_model:401 | Epoch 22/30 completed | Avg Loss: 0.0022
2025-10-09 05:06:52 | INFO     | train_model:401 | Epoch 23/30 completed | Avg Loss: 0.0013
2025-10-09 05:07:39 | INFO     | train_model:401 | Epoch 24/30 completed | Avg Loss: 0.0016
2025-10-09 05:08:26 | INFO     | train_model:401 | Epoch 25/30 completed | Avg Loss: 0.0012
2025-10-09 05:09:12 | INFO     | train_model:401 | Epoch 26/30 completed | Avg Loss: 0.0003
2025-10-09 05:09:59 | INFO     | train_model:401 | Epoch 27/30 completed | Avg Loss: 0.0013
2025-10-09 05:10:45 | INFO     | train_model:401 | Epoch 28/30 completed | Avg Loss: 0.0007
2025-10-09 05:11:32 | INFO     | train_model:401 | Epoch 29/30 completed | Avg Loss: 0.0010
2025-10-09 05:12:19 | INFO     | train_model:401 | Epoch 30/30 completed | Avg Loss: 0.0007
2025-10-09 05:12:19 | INFO     | train_model:403 | Training complete
2025-10-09 05:12:19 | INFO     | train_model:404 | Final average loss: 0.0007
2025-10-09 05:12:19 | DEBUG    | train_model:405 | Loss history: [0.45736633359573464, 0.023937784990498874, 0.030784618534256725, 0.01964693918590127, 0.053493292584267264, 0.028487309791207154, 0.014383279244282947, 0.01107564347903269, 0.015524540860187312, 0.0181352651696293, 0.04216420486246786, 0.018198163089920776, 0.007651838768729346, 0.008403216165034076, 0.0035793200541059163, 0.004338389822650958, 0.004915631086058714, 0.023921060726663317, 0.0056828486302696, 0.009366521128732588, 0.005081248504521159, 0.0022264872701619406, 0.001308239440441731, 0.001649407602173519, 0.0012146800638529773, 0.0002545812452653797, 0.0012918311715227591, 0.0007405013534577287, 0.0009859560468225453, 0.0007047089399380407]
2025-10-09 05:12:19 | INFO     | <module>:654 | === Generating synthetic patient data ===
2025-10-09 05:12:19 | INFO     | <module>:663 | 
--- Sample 1/5 ---
2025-10-09 05:12:19 | INFO     | generate_patient_sequence:443 | Generating sequence for prompt: '62 BLACK M <demo>'
2025-10-09 05:12:19 | DEBUG    | generate_patient_sequence:447 | Prompt token IDs: [0, 5379, 34101, 256, 28696, 12789, 139, 15698, 2]
2025-10-09 05:12:19 | DEBUG    | generate_patient_sequence:448 | Prompt tokens: ['<s>', '62', ' BLACK', ' M', ' <', 'dem', 'o', '>', '</s>']
2025-10-09 05:12:19 | DEBUG    | generate_patient_sequence:457 | Special token IDs - <v>: 50265, <\v>: 50266, <END>: 50267, PAD: 1, EOS: 2
2025-10-09 05:12:19 | DEBUG    | generate_patient_sequence:464 | Initial decoder input (with forced <v>): [0, 5379, 34101, 256, 28696, 12789, 139, 15698, 2, 50265]
2025-10-09 05:12:19 | DEBUG    | generate_patient_sequence:478 | After prompt, probability of <v>: 0.001738
2025-10-09 05:12:19 | DEBUG    | generate_patient_sequence:479 | After prompt, probability of <END>: 0.051670
2025-10-09 05:12:19 | DEBUG    | generate_patient_sequence:480 | After prompt, probability of PAD: 0.000000
2025-10-09 05:12:19 | DEBUG    | generate_patient_sequence:481 | After prompt, probability of EOS: 0.810399
2025-10-09 05:12:19 | DEBUG    | generate_patient_sequence:485 | Top 20 next token predictions after prompt:
2025-10-09 05:12:19 | DEBUG    | generate_patient_sequence:503 |   Rank 1: <EOS>                | Prob: 0.810399 | ID: 2
2025-10-09 05:12:19 | DEBUG    | generate_patient_sequence:503 |   Rank 2:                      | Prob: 0.134035 | ID: 1437
2025-10-09 05:12:19 | DEBUG    | generate_patient_sequence:503 |   Rank 3: <END>                | Prob: 0.051670 | ID: 50267
2025-10-09 05:12:19 | DEBUG    | generate_patient_sequence:503 |   Rank 4: <v>                  | Prob: 0.001738 | ID: 50265
2025-10-09 05:12:19 | DEBUG    | generate_patient_sequence:503 |   Rank 5: <\v>                 | Prob: 0.000943 | ID: 50266
2025-10-09 05:12:19 | DEBUG    | generate_patient_sequence:503 |   Rank 6: L                    | Prob: 0.000190 | ID: 574
2025-10-09 05:12:19 | DEBUG    | generate_patient_sequence:503 |   Rank 7:  R                   | Prob: 0.000095 | ID: 248
2025-10-09 05:12:19 | DEBUG    | generate_patient_sequence:503 |   Rank 8:  M                   | Prob: 0.000089 | ID: 256
2025-10-09 05:12:19 | DEBUG    | generate_patient_sequence:503 |   Rank 9:  F                   | Prob: 0.000083 | ID: 274
2025-10-09 05:12:19 | DEBUG    | generate_patient_sequence:503 |   Rank 10:  SPEC                | Prob: 0.000045 | ID: 44921
2025-10-09 05:12:19 | DEBUG    | generate_patient_sequence:503 |   Rank 11:  V                   | Prob: 0.000030 | ID: 468
2025-10-09 05:12:19 | DEBUG    | generate_patient_sequence:503 |   Rank 12:  UN                  | Prob: 0.000023 | ID: 2604
2025-10-09 05:12:19 | DEBUG    | generate_patient_sequence:503 |   Rank 13:  E                   | Prob: 0.000021 | ID: 381
2025-10-09 05:12:19 | DEBUG    | generate_patient_sequence:503 |   Rank 14:  DEC                 | Prob: 0.000019 | ID: 16718
2025-10-09 05:12:19 | DEBUG    | generate_patient_sequence:503 |   Rank 15:  LAT                 | Prob: 0.000017 | ID: 21455
2025-10-09 05:12:19 | DEBUG    | generate_patient_sequence:503 |   Rank 16:  is                  | Prob: 0.000016 | ID: 16
2025-10-09 05:12:19 | DEBUG    | generate_patient_sequence:503 |   Rank 17:  AS                  | Prob: 0.000015 | ID: 6015
2025-10-09 05:12:19 | DEBUG    | generate_patient_sequence:503 |   Rank 18: IAN                  | Prob: 0.000013 | ID: 10296
2025-10-09 05:12:19 | DEBUG    | generate_patient_sequence:503 |   Rank 19:  AMER                | Prob: 0.000012 | ID: 37501
2025-10-09 05:12:19 | DEBUG    | generate_patient_sequence:503 |   Rank 20: AL                   | Prob: 0.000011 | ID: 2118
2025-10-09 05:12:19 | INFO     | generate_patient_sequence:507 | Starting generation with temp=1.0, top_k=100, max_length=256
2025-10-09 05:12:19 | DEBUG    | generate_patient_sequence:520 | Generated token IDs: [2, 0, 5379, 34101, 256, 28696, 12789, 139, 15698, 2, 50265, 2, 5379, 34101, 274, 28696, 12789, 366, 15698, 1437, 50265, 2, 2, 50267]
2025-10-09 05:12:19 | DEBUG    | generate_patient_sequence:521 | Generated length: 24 tokens
2025-10-09 05:12:19 | INFO     | generate_patient_sequence:529 | Generated token counts - <v>: 2, <\v>: 0, <END>: 1
2025-10-09 05:12:19 | DEBUG    | generate_patient_sequence:537 | Raw generated sequence: </s><s>62 BLACK M <demo></s> <v> </s>62 BLACK F <demos>  <v> </s></s> <END>
2025-10-09 05:12:19 | INFO     | generate_patient_sequence:540 | Generated sequence (clean): 62 BLACK M <demo>62 BLACK F <demos> 
2025-10-09 05:12:19 | INFO     | <module>:663 | 
--- Sample 2/5 ---
2025-10-09 05:12:19 | INFO     | generate_patient_sequence:443 | Generating sequence for prompt: '54 UNKNOWN/NOT SPECIFIED F <demo>'
2025-10-09 05:12:19 | DEBUG    | generate_patient_sequence:447 | Prompt token IDs: [0, 4283, 2604, 47300, 73, 37049, 44921, 36482, 274, 28696, 12789, 139, 15698, 2]
2025-10-09 05:12:19 | DEBUG    | generate_patient_sequence:448 | Prompt tokens: ['<s>', '54', ' UN', 'KNOWN', '/', 'NOT', ' SPEC', 'IFIED', ' F', ' <', 'dem', 'o', '>', '</s>']
2025-10-09 05:12:19 | DEBUG    | generate_patient_sequence:457 | Special token IDs - <v>: 50265, <\v>: 50266, <END>: 50267, PAD: 1, EOS: 2
2025-10-09 05:12:19 | DEBUG    | generate_patient_sequence:464 | Initial decoder input (with forced <v>): [0, 4283, 2604, 47300, 73, 37049, 44921, 36482, 274, 28696, 12789, 139, 15698, 2, 50265]
2025-10-09 05:12:19 | DEBUG    | generate_patient_sequence:478 | After prompt, probability of <v>: 0.000584
2025-10-09 05:12:19 | DEBUG    | generate_patient_sequence:479 | After prompt, probability of <END>: 0.002594
2025-10-09 05:12:19 | DEBUG    | generate_patient_sequence:480 | After prompt, probability of PAD: 0.000000
2025-10-09 05:12:19 | DEBUG    | generate_patient_sequence:481 | After prompt, probability of EOS: 0.953223
2025-10-09 05:12:19 | DEBUG    | generate_patient_sequence:485 | Top 20 next token predictions after prompt:
2025-10-09 05:12:19 | DEBUG    | generate_patient_sequence:503 |   Rank 1: <EOS>                | Prob: 0.953223 | ID: 2
2025-10-09 05:12:19 | DEBUG    | generate_patient_sequence:503 |   Rank 2:                      | Prob: 0.042383 | ID: 1437
2025-10-09 05:12:19 | DEBUG    | generate_patient_sequence:503 |   Rank 3: <END>                | Prob: 0.002594 | ID: 50267
2025-10-09 05:12:19 | DEBUG    | generate_patient_sequence:503 |   Rank 4: <v>                  | Prob: 0.000584 | ID: 50265
2025-10-09 05:12:19 | DEBUG    | generate_patient_sequence:503 |   Rank 5: <\v>                 | Prob: 0.000242 | ID: 50266
2025-10-09 05:12:19 | DEBUG    | generate_patient_sequence:503 |   Rank 6: NOT                  | Prob: 0.000155 | ID: 37049
2025-10-09 05:12:19 | DEBUG    | generate_patient_sequence:503 |   Rank 7:  is                  | Prob: 0.000059 | ID: 16
2025-10-09 05:12:19 | DEBUG    | generate_patient_sequence:503 |   Rank 8:  SPEC                | Prob: 0.000051 | ID: 44921
2025-10-09 05:12:19 | DEBUG    | generate_patient_sequence:503 |   Rank 9: AF                   | Prob: 0.000039 | ID: 8573
2025-10-09 05:12:19 | DEBUG    | generate_patient_sequence:503 |   Rank 10:  F                   | Prob: 0.000030 | ID: 274
2025-10-09 05:12:19 | DEBUG    | generate_patient_sequence:503 |   Rank 11: LIN                  | Prob: 0.000029 | ID: 13748
2025-10-09 05:12:19 | DEBUG    | generate_patient_sequence:503 |   Rank 12: KNOWN                | Prob: 0.000024 | ID: 47300
2025-10-09 05:12:19 | DEBUG    | generate_patient_sequence:503 |   Rank 13: L                    | Prob: 0.000020 | ID: 574
2025-10-09 05:12:19 | DEBUG    | generate_patient_sequence:503 |   Rank 14: N                    | Prob: 0.000014 | ID: 487
2025-10-09 05:12:19 | DEBUG    | generate_patient_sequence:503 |   Rank 15: P                    | Prob: 0.000012 | ID: 510
2025-10-09 05:12:19 | DEBUG    | generate_patient_sequence:503 |   Rank 16:  R                   | Prob: 0.000011 | ID: 248
2025-10-09 05:12:19 | DEBUG    | generate_patient_sequence:503 |   Rank 17: o                    | Prob: 0.000008 | ID: 139
2025-10-09 05:12:19 | DEBUG    | generate_patient_sequence:503 |   Rank 18: AN                   | Prob: 0.000008 | ID: 1889
2025-10-09 05:12:19 | DEBUG    | generate_patient_sequence:503 |   Rank 19: IAN                  | Prob: 0.000007 | ID: 10296
2025-10-09 05:12:19 | DEBUG    | generate_patient_sequence:503 |   Rank 20:  M                   | Prob: 0.000006 | ID: 256
2025-10-09 05:12:19 | INFO     | generate_patient_sequence:507 | Starting generation with temp=1.0, top_k=100, max_length=256
2025-10-09 05:12:19 | DEBUG    | generate_patient_sequence:520 | Generated token IDs: [2, 0, 4283, 2604, 47300, 73, 37049, 44921, 36482, 274, 28696, 12789, 139, 15698, 2, 50265, 44921, 36482, 381, 15698, 1437, 50265, 2, 2, 176, 139, 15698, 1437, 50267]
2025-10-09 05:12:19 | DEBUG    | generate_patient_sequence:521 | Generated length: 29 tokens
2025-10-09 05:12:19 | INFO     | generate_patient_sequence:529 | Generated token counts - <v>: 2, <\v>: 0, <END>: 1
2025-10-09 05:12:19 | DEBUG    | generate_patient_sequence:537 | Raw generated sequence: </s><s>54 UNKNOWN/NOT SPECIFIED F <demo></s> <v>  SPECIFIED E>  <v> </s></s>2o>  <END>
2025-10-09 05:12:19 | INFO     | generate_patient_sequence:540 | Generated sequence (clean): 54 UNKNOWN/NOT SPECIFIED F <demo> SPECIFIED E> 2o> 
2025-10-09 05:12:19 | INFO     | <module>:663 | 
--- Sample 3/5 ---
2025-10-09 05:12:19 | INFO     | generate_patient_sequence:443 | Generating sequence for prompt: '33 OTHER F <demo>'
2025-10-09 05:12:19 | DEBUG    | generate_patient_sequence:447 | Prompt token IDs: [0, 3103, 16536, 274, 28696, 12789, 139, 15698, 2]
2025-10-09 05:12:19 | DEBUG    | generate_patient_sequence:448 | Prompt tokens: ['<s>', '33', ' OTHER', ' F', ' <', 'dem', 'o', '>', '</s>']
2025-10-09 05:12:19 | DEBUG    | generate_patient_sequence:457 | Special token IDs - <v>: 50265, <\v>: 50266, <END>: 50267, PAD: 1, EOS: 2
2025-10-09 05:12:19 | DEBUG    | generate_patient_sequence:464 | Initial decoder input (with forced <v>): [0, 3103, 16536, 274, 28696, 12789, 139, 15698, 2, 50265]
2025-10-09 05:12:19 | DEBUG    | generate_patient_sequence:478 | After prompt, probability of <v>: 0.000515
2025-10-09 05:12:19 | DEBUG    | generate_patient_sequence:479 | After prompt, probability of <END>: 0.019596
2025-10-09 05:12:19 | DEBUG    | generate_patient_sequence:480 | After prompt, probability of PAD: 0.000000
2025-10-09 05:12:19 | DEBUG    | generate_patient_sequence:481 | After prompt, probability of EOS: 0.882961
2025-10-09 05:12:19 | DEBUG    | generate_patient_sequence:485 | Top 20 next token predictions after prompt:
2025-10-09 05:12:19 | DEBUG    | generate_patient_sequence:503 |   Rank 1: <EOS>                | Prob: 0.882961 | ID: 2
2025-10-09 05:12:19 | DEBUG    | generate_patient_sequence:503 |   Rank 2:                      | Prob: 0.095798 | ID: 1437
2025-10-09 05:12:19 | DEBUG    | generate_patient_sequence:503 |   Rank 3: <END>                | Prob: 0.019596 | ID: 50267
2025-10-09 05:12:19 | DEBUG    | generate_patient_sequence:503 |   Rank 4: <v>                  | Prob: 0.000515 | ID: 50265
2025-10-09 05:12:19 | DEBUG    | generate_patient_sequence:503 |   Rank 5: <\v>                 | Prob: 0.000508 | ID: 50266
2025-10-09 05:12:19 | DEBUG    | generate_patient_sequence:503 |   Rank 6:  F                   | Prob: 0.000087 | ID: 274
2025-10-09 05:12:19 | DEBUG    | generate_patient_sequence:503 |   Rank 7:  R                   | Prob: 0.000080 | ID: 248
2025-10-09 05:12:19 | DEBUG    | generate_patient_sequence:503 |   Rank 8: L                    | Prob: 0.000044 | ID: 574
2025-10-09 05:12:19 | DEBUG    | generate_patient_sequence:503 |   Rank 9:  E                   | Prob: 0.000044 | ID: 381
2025-10-09 05:12:19 | DEBUG    | generate_patient_sequence:503 |   Rank 10:  M                   | Prob: 0.000036 | ID: 256
2025-10-09 05:12:19 | DEBUG    | generate_patient_sequence:503 |   Rank 11:  SPEC                | Prob: 0.000028 | ID: 44921
2025-10-09 05:12:19 | DEBUG    | generate_patient_sequence:503 |   Rank 12:  V                   | Prob: 0.000010 | ID: 468
2025-10-09 05:12:19 | DEBUG    | generate_patient_sequence:503 |   Rank 13: IAN                  | Prob: 0.000009 | ID: 10296
2025-10-09 05:12:19 | DEBUG    | generate_patient_sequence:503 |   Rank 14: N                    | Prob: 0.000008 | ID: 487
2025-10-09 05:12:19 | DEBUG    | generate_patient_sequence:503 |   Rank 15:  is                  | Prob: 0.000007 | ID: 16
2025-10-09 05:12:19 | DEBUG    | generate_patient_sequence:503 |   Rank 16: KNOWN                | Prob: 0.000007 | ID: 47300
2025-10-09 05:12:19 | DEBUG    | generate_patient_sequence:503 |   Rank 17:  LAT                 | Prob: 0.000007 | ID: 21455
2025-10-09 05:12:19 | DEBUG    | generate_patient_sequence:503 |   Rank 18:  DEC                 | Prob: 0.000006 | ID: 16718
2025-10-09 05:12:19 | DEBUG    | generate_patient_sequence:503 |   Rank 19:  AMER                | Prob: 0.000006 | ID: 37501
2025-10-09 05:12:19 | DEBUG    | generate_patient_sequence:503 |   Rank 20:  UN                  | Prob: 0.000006 | ID: 2604
2025-10-09 05:12:19 | INFO     | generate_patient_sequence:507 | Starting generation with temp=1.0, top_k=100, max_length=256
2025-10-09 05:12:19 | DEBUG    | generate_patient_sequence:520 | Generated token IDs: [2, 0, 3103, 16536, 274, 28696, 12789, 139, 15698, 2, 50265, 2, 2, 2, 1437, 50266, 139, 15698, 1437, 50267]
2025-10-09 05:12:19 | DEBUG    | generate_patient_sequence:521 | Generated length: 20 tokens
2025-10-09 05:12:19 | INFO     | generate_patient_sequence:529 | Generated token counts - <v>: 1, <\v>: 1, <END>: 1
2025-10-09 05:12:19 | DEBUG    | generate_patient_sequence:537 | Raw generated sequence: </s><s>33 OTHER F <demo></s> <v> </s></s></s>  <\v> o>  <END>
2025-10-09 05:12:19 | INFO     | generate_patient_sequence:540 | Generated sequence (clean): 33 OTHER F <demo> o> 
2025-10-09 05:12:19 | INFO     | <module>:663 | 
--- Sample 4/5 ---
2025-10-09 05:12:19 | INFO     | generate_patient_sequence:443 | Generating sequence for prompt: '80 UNABLE TO OBTAIN M <demo>'
2025-10-09 05:12:19 | DEBUG    | generate_patient_sequence:447 | Prompt token IDs: [0, 2940, 121, 4444, 30876, 3842, 28214, 23177, 256, 28696, 12789, 139, 15698, 2]
2025-10-09 05:12:19 | DEBUG    | generate_patient_sequence:448 | Prompt tokens: ['<s>', '80', ' U', 'NA', 'BLE', ' TO', ' OB', 'TAIN', ' M', ' <', 'dem', 'o', '>', '</s>']
2025-10-09 05:12:19 | DEBUG    | generate_patient_sequence:457 | Special token IDs - <v>: 50265, <\v>: 50266, <END>: 50267, PAD: 1, EOS: 2
2025-10-09 05:12:19 | DEBUG    | generate_patient_sequence:464 | Initial decoder input (with forced <v>): [0, 2940, 121, 4444, 30876, 3842, 28214, 23177, 256, 28696, 12789, 139, 15698, 2, 50265]
2025-10-09 05:12:19 | DEBUG    | generate_patient_sequence:478 | After prompt, probability of <v>: 0.038407
2025-10-09 05:12:19 | DEBUG    | generate_patient_sequence:479 | After prompt, probability of <END>: 0.062181
2025-10-09 05:12:19 | DEBUG    | generate_patient_sequence:480 | After prompt, probability of PAD: 0.000000
2025-10-09 05:12:19 | DEBUG    | generate_patient_sequence:481 | After prompt, probability of EOS: 0.394013
2025-10-09 05:12:19 | DEBUG    | generate_patient_sequence:485 | Top 20 next token predictions after prompt:
2025-10-09 05:12:19 | DEBUG    | generate_patient_sequence:503 |   Rank 1:                      | Prob: 0.499453 | ID: 1437
2025-10-09 05:12:19 | DEBUG    | generate_patient_sequence:503 |   Rank 2: <EOS>                | Prob: 0.394013 | ID: 2
2025-10-09 05:12:19 | DEBUG    | generate_patient_sequence:503 |   Rank 3: <END>                | Prob: 0.062181 | ID: 50267
2025-10-09 05:12:19 | DEBUG    | generate_patient_sequence:503 |   Rank 4: <v>                  | Prob: 0.038407 | ID: 50265
2025-10-09 05:12:19 | DEBUG    | generate_patient_sequence:503 |   Rank 5: <\v>                 | Prob: 0.001817 | ID: 50266
2025-10-09 05:12:19 | DEBUG    | generate_patient_sequence:503 |   Rank 6: L                    | Prob: 0.000765 | ID: 574
2025-10-09 05:12:19 | DEBUG    | generate_patient_sequence:503 |   Rank 7:  is                  | Prob: 0.000205 | ID: 16
2025-10-09 05:12:19 | DEBUG    | generate_patient_sequence:503 |   Rank 8: P                    | Prob: 0.000077 | ID: 510
2025-10-09 05:12:19 | DEBUG    | generate_patient_sequence:503 |   Rank 9:  has                 | Prob: 0.000076 | ID: 34
2025-10-09 05:12:19 | DEBUG    | generate_patient_sequence:503 |   Rank 10:  F                   | Prob: 0.000074 | ID: 274
2025-10-09 05:12:19 | DEBUG    | generate_patient_sequence:503 |   Rank 11: AF                   | Prob: 0.000070 | ID: 8573
2025-10-09 05:12:19 | DEBUG    | generate_patient_sequence:503 |   Rank 12: LIN                  | Prob: 0.000063 | ID: 13748
2025-10-09 05:12:19 | DEBUG    | generate_patient_sequence:503 |   Rank 13:  R                   | Prob: 0.000059 | ID: 248
2025-10-09 05:12:19 | DEBUG    | generate_patient_sequence:503 |   Rank 14:  M                   | Prob: 0.000055 | ID: 256
2025-10-09 05:12:19 | DEBUG    | generate_patient_sequence:503 |   Rank 15: o                    | Prob: 0.000053 | ID: 139
2025-10-09 05:12:19 | DEBUG    | generate_patient_sequence:503 |   Rank 16: KNOWN                | Prob: 0.000048 | ID: 47300
2025-10-09 05:12:19 | DEBUG    | generate_patient_sequence:503 |   Rank 17:  E                   | Prob: 0.000043 | ID: 381
2025-10-09 05:12:19 | DEBUG    | generate_patient_sequence:503 |   Rank 18:  SPEC                | Prob: 0.000042 | ID: 44921
2025-10-09 05:12:19 | DEBUG    | generate_patient_sequence:503 |   Rank 19: dem                  | Prob: 0.000037 | ID: 12789
2025-10-09 05:12:19 | DEBUG    | generate_patient_sequence:503 |   Rank 20:  LAT                 | Prob: 0.000034 | ID: 21455
2025-10-09 05:12:19 | INFO     | generate_patient_sequence:507 | Starting generation with temp=1.0, top_k=100, max_length=256
2025-10-09 05:12:19 | DEBUG    | generate_patient_sequence:520 | Generated token IDs: [2, 0, 2940, 121, 4444, 30876, 3842, 28214, 23177, 256, 28696, 12789, 139, 15698, 2, 50265, 2, 2, 2, 2940, 2604, 4444, 30876, 6390, 28214, 23177, 1437, 50266, 1437, 50267]
2025-10-09 05:12:19 | DEBUG    | generate_patient_sequence:521 | Generated length: 30 tokens
2025-10-09 05:12:19 | INFO     | generate_patient_sequence:529 | Generated token counts - <v>: 1, <\v>: 1, <END>: 1
2025-10-09 05:12:19 | DEBUG    | generate_patient_sequence:537 | Raw generated sequence: </s><s>80 UNABLE TO OBTAIN M <demo></s> <v> </s></s></s>80 UNNABLETO OBTAIN  <\v>   <END>
2025-10-09 05:12:19 | INFO     | generate_patient_sequence:540 | Generated sequence (clean): 80 UNABLE TO OBTAIN M <demo>80 UNNABLETO OBTAIN  
2025-10-09 05:12:19 | INFO     | <module>:663 | 
--- Sample 5/5 ---
2025-10-09 05:12:19 | INFO     | generate_patient_sequence:443 | Generating sequence for prompt: '43 UNABLE TO OBTAIN F <demo>'
2025-10-09 05:12:19 | DEBUG    | generate_patient_sequence:447 | Prompt token IDs: [0, 3897, 121, 4444, 30876, 3842, 28214, 23177, 274, 28696, 12789, 139, 15698, 2]
2025-10-09 05:12:19 | DEBUG    | generate_patient_sequence:448 | Prompt tokens: ['<s>', '43', ' U', 'NA', 'BLE', ' TO', ' OB', 'TAIN', ' F', ' <', 'dem', 'o', '>', '</s>']
2025-10-09 05:12:19 | DEBUG    | generate_patient_sequence:457 | Special token IDs - <v>: 50265, <\v>: 50266, <END>: 50267, PAD: 1, EOS: 2
2025-10-09 05:12:19 | DEBUG    | generate_patient_sequence:464 | Initial decoder input (with forced <v>): [0, 3897, 121, 4444, 30876, 3842, 28214, 23177, 274, 28696, 12789, 139, 15698, 2, 50265]
2025-10-09 05:12:20 | DEBUG    | generate_patient_sequence:478 | After prompt, probability of <v>: 0.035740
2025-10-09 05:12:20 | DEBUG    | generate_patient_sequence:479 | After prompt, probability of <END>: 0.031280
2025-10-09 05:12:20 | DEBUG    | generate_patient_sequence:480 | After prompt, probability of PAD: 0.000000
2025-10-09 05:12:20 | DEBUG    | generate_patient_sequence:481 | After prompt, probability of EOS: 0.791348
2025-10-09 05:12:20 | DEBUG    | generate_patient_sequence:485 | Top 20 next token predictions after prompt:
2025-10-09 05:12:20 | DEBUG    | generate_patient_sequence:503 |   Rank 1: <EOS>                | Prob: 0.791348 | ID: 2
2025-10-09 05:12:20 | DEBUG    | generate_patient_sequence:503 |   Rank 2:                      | Prob: 0.127591 | ID: 1437
2025-10-09 05:12:20 | DEBUG    | generate_patient_sequence:503 |   Rank 3: <v>                  | Prob: 0.035740 | ID: 50265
2025-10-09 05:12:20 | DEBUG    | generate_patient_sequence:503 |   Rank 4: <END>                | Prob: 0.031280 | ID: 50267
2025-10-09 05:12:20 | DEBUG    | generate_patient_sequence:503 |   Rank 5: <\v>                 | Prob: 0.003202 | ID: 50266
2025-10-09 05:12:20 | DEBUG    | generate_patient_sequence:503 |   Rank 6: L                    | Prob: 0.001526 | ID: 574
2025-10-09 05:12:20 | DEBUG    | generate_patient_sequence:503 |   Rank 7: KNOWN                | Prob: 0.000594 | ID: 47300
2025-10-09 05:12:20 | DEBUG    | generate_patient_sequence:503 |   Rank 8:  is                  | Prob: 0.000485 | ID: 16
2025-10-09 05:12:20 | DEBUG    | generate_patient_sequence:503 |   Rank 9: LIN                  | Prob: 0.000481 | ID: 13748
2025-10-09 05:12:20 | DEBUG    | generate_patient_sequence:503 |   Rank 10: o                    | Prob: 0.000322 | ID: 139
2025-10-09 05:12:20 | DEBUG    | generate_patient_sequence:503 |   Rank 11:  F                   | Prob: 0.000272 | ID: 274
2025-10-09 05:12:20 | DEBUG    | generate_patient_sequence:503 |   Rank 12:  has                 | Prob: 0.000232 | ID: 34
2025-10-09 05:12:20 | DEBUG    | generate_patient_sequence:503 |   Rank 13: P                    | Prob: 0.000211 | ID: 510
2025-10-09 05:12:20 | DEBUG    | generate_patient_sequence:503 |   Rank 14: AF                   | Prob: 0.000125 | ID: 8573
2025-10-09 05:12:20 | DEBUG    | generate_patient_sequence:503 |   Rank 15:  LAT                 | Prob: 0.000121 | ID: 21455
2025-10-09 05:12:20 | DEBUG    | generate_patient_sequence:503 |   Rank 16:  M                   | Prob: 0.000107 | ID: 256
2025-10-09 05:12:20 | DEBUG    | generate_patient_sequence:503 |   Rank 17: dem                  | Prob: 0.000075 | ID: 12789
2025-10-09 05:12:20 | DEBUG    | generate_patient_sequence:503 |   Rank 18:  SPEC                | Prob: 0.000056 | ID: 44921
2025-10-09 05:12:20 | DEBUG    | generate_patient_sequence:503 |   Rank 19:  E                   | Prob: 0.000052 | ID: 381
2025-10-09 05:12:20 | DEBUG    | generate_patient_sequence:503 |   Rank 20: 441                  | Prob: 0.000050 | ID: 36011
2025-10-09 05:12:20 | INFO     | generate_patient_sequence:507 | Starting generation with temp=1.0, top_k=100, max_length=256
2025-10-09 05:12:20 | DEBUG    | generate_patient_sequence:520 | Generated token IDs: [2, 0, 3897, 121, 4444, 30876, 3842, 28214, 23177, 274, 28696, 12789, 139, 15698, 2, 50265, 2, 2, 2, 3414, 121, 4444, 7976, 3842, 28214, 13748, 274, 28696, 24658, 139, 15698, 1437, 50265, 379, 2831, 274, 288, 50265, 2, 4563, 2, 2, 3897, 2604, 47300, 3842, 2, 2, 50266, 1437, 50267]
2025-10-09 05:12:20 | DEBUG    | generate_patient_sequence:521 | Generated length: 51 tokens
2025-10-09 05:12:20 | INFO     | generate_patient_sequence:529 | Generated token counts - <v>: 3, <\v>: 1, <END>: 1
2025-10-09 05:12:20 | DEBUG    | generate_patient_sequence:537 | Raw generated sequence: </s><s>43 UNABLE TO OBTAIN F <demo></s> <v> </s></s></s>49 UNABL TO OBLIN F <Demo>  <v>  1599 F0 <v> </s>69</s></s>43 UNKNOWN TO</s></s> <\v>   <END>
2025-10-09 05:12:20 | INFO     | generate_patient_sequence:540 | Generated sequence (clean): 43 UNABLE TO OBTAIN F <demo>49 UNABL TO OBLIN F <Demo>  1599 F06943 UNKNOWN TO 
2025-10-09 05:12:20 | INFO     | <module>:677 | === Training and generation complete ===
