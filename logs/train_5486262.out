========================================
PromptEHR Training Job
========================================
Job ID: 5486262
Job Name: promptehr_10k_50ep
Node: ccc0389
Partition: IllinoisComputes-GPU
Working Directory: /u/jalenj4/pehr_scratch
CUDA_VISIBLE_DEVICES: 0
Start Time: Thu Oct 23 03:19:54 CDT 2025
========================================
GPU Information:
Thu Oct 23 03:19:54 2025       
+-----------------------------------------------------------------------------------------+
| NVIDIA-SMI 580.95.05              Driver Version: 580.95.05      CUDA Version: 13.0     |
+-----------------------------------------+------------------------+----------------------+
| GPU  Name                 Persistence-M | Bus-Id          Disp.A | Volatile Uncorr. ECC |
| Fan  Temp   Perf          Pwr:Usage/Cap |           Memory-Usage | GPU-Util  Compute M. |
|                                         |                        |               MIG M. |
|=========================================+========================+======================|
|   0  NVIDIA A100-SXM4-80GB          On  |   00000000:41:00.0 Off |                    0 |
| N/A   27C    P0             62W /  500W |       0MiB /  81920MiB |      0%      Default |
|                                         |                        |             Disabled |
+-----------------------------------------+------------------------+----------------------+

+-----------------------------------------------------------------------------------------+
| Processes:                                                                              |
|  GPU   GI   CI              PID   Type   Process name                        GPU Memory |
|        ID   ID                                                               Usage      |
|=========================================================================================|
|  No running processes found                                                             |
+-----------------------------------------------------------------------------------------+
========================================
Environment:
Python version: Python 3.12.11
PyTorch version: 2.8.0+cu128
CUDA available: True
CUDA version: 12.8
========================================
Starting PromptEHR training...
2025-10-23 03:20:14,560 - INFO - ================================================================================
2025-10-23 03:20:14,561 - INFO - PromptEHR Training Pipeline - Phase 3
2025-10-23 03:20:14,561 - INFO - ================================================================================
2025-10-23 03:20:14,561 - INFO - 
Configuration:

[Data]
  Patients: 10000
  Max sequence length: 256
  Train/val split: 0.2

[Model]
  Base model: facebook/bart-base
  Continuous features: 1
  Categorical features: 1
  Prompt length: 1

[Training]
  Batch size: 8
  Epochs: 50
  Learning rate: 0.0001
  Warmup steps: 1000
  Device: cuda

[Corruptions]
  Lambda Poisson: 3.0
  Deletion prob: 0.15
  Replacement prob: 0.15
  Corruption prob: 0.5
  Mask infilling: True
  Token deletion: True
  Token replacement: True
  Next-visit prediction: True

[Evaluation]
  Compute TPL: True
  Compute SPL: False
2025-10-23 03:20:14,573 - INFO - 
Random seed: 42
2025-10-23 03:20:14,726 - INFO - Device: cuda
2025-10-23 03:20:14,726 - INFO - 
================================================================================
2025-10-23 03:20:14,727 - INFO - Loading MIMIC-III Data
2025-10-23 03:20:14,727 - INFO - ================================================================================
2025-10-23 03:20:14,727 - INFO - Loading MIMIC-III data files
2025-10-23 03:20:14,804 - INFO - Loaded 46520 patients
2025-10-23 03:20:15,002 - INFO - Loaded 58976 admissions
2025-10-23 03:20:15,245 - INFO - Loaded 651047 diagnosis records
2025-10-23 03:20:15,550 - INFO - Processing patient records
2025-10-23 03:20:23,893 - INFO - Loaded 10000 patient records
2025-10-23 03:20:23,893 - INFO - Diagnosis vocabulary size: 4253
2025-10-23 03:20:23,897 - INFO - Average visits per patient: 1.29
2025-10-23 03:20:23,897 - INFO - Average codes per visit: 9.16
2025-10-23 03:20:23,899 - INFO - Gender distribution: {'M': 5615, 'F': 4385}
2025-10-23 03:20:23,918 - INFO - Loaded 10000 patients
2025-10-23 03:20:23,918 - INFO - Vocabulary size: 4253 diagnosis codes
2025-10-23 03:20:23,918 - INFO - Tokenizer vocab size: 4260
2025-10-23 03:20:23,919 - INFO - Dataset size: 10000 patients
2025-10-23 03:20:23,924 - INFO - Train size: 8000, Validation size: 2000
2025-10-23 03:20:23,924 - INFO - Train batches: 1000, Validation batches: 250
2025-10-23 03:20:23,924 - INFO - 
================================================================================
2025-10-23 03:20:23,924 - INFO - Initializing Model
2025-10-23 03:20:23,924 - INFO - ================================================================================
2025-10-23 03:20:24,029 - INFO - BART config vocab size: 4260
2025-10-23 03:20:25,903 - INFO - Model: PromptBartWithDemographicPrediction (multi-task learning)
2025-10-23 03:20:25,903 - INFO -   Age loss weight: 0.3
2025-10-23 03:20:25,903 - INFO -   Sex loss weight: 0.2
2025-10-23 03:20:26,176 - INFO - Total parameters: 104,681,731
2025-10-23 03:20:26,176 - INFO - Trainable parameters: 104,681,731
2025-10-23 03:20:26,177 - INFO - Total training steps: 50000
2025-10-23 03:20:26,177 - INFO - Warmup steps: 1000
2025-10-23 03:20:26,177 - INFO - 
================================================================================
2025-10-23 03:20:26,177 - INFO - Starting Training
2025-10-23 03:20:26,177 - INFO - ================================================================================
========================================
Training completed
End Time: Thu Oct 23 03:20:28 CDT 2025
Exit Code: 1
========================================
