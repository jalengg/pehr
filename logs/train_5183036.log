2025-10-09 05:12:33 | INFO     | <module>:562 | === EHR Generation Training Started ===
2025-10-09 05:12:33 | INFO     | <module>:583 | Configuration: {'model_name': 'facebook/bart-base', 'num_patients': 3000, 'max_seq_length': 256, 'batch_size': 16, 'num_epochs': 30, 'learning_rate': 0.0002, 'generation_temp': 1.5, 'generation_max_length': 256, 'num_warmup_steps': 0, 'top_k': 100, 'data_dir': 'data_files', 'mimic_paths': {'patients_path': 'data_files/PATIENTS.csv', 'admissions_path': 'data_files/ADMISSIONS.csv', 'diagnoses_path': 'data_files/DIAGNOSES_ICD.csv'}}
2025-10-09 05:12:34 | INFO     | <module>:587 | Using device: cuda
2025-10-09 05:12:34 | INFO     | <module>:590 | Loading pretrained BART model: facebook/bart-base
2025-10-09 05:12:34 | INFO     | <module>:599 | Added 3 special tokens: <v>, <\v>, <END>
2025-10-09 05:12:35 | INFO     | <module>:603 | Resized model embeddings to 50268 tokens
2025-10-09 05:12:35 | DEBUG    | <module>:606 | Token ID for <v>: 50265
2025-10-09 05:12:35 | DEBUG    | <module>:607 | Token ID for <\v>: 50266
2025-10-09 05:12:35 | DEBUG    | <module>:608 | Token ID for <END>: 50267
2025-10-09 05:12:35 | INFO     | load_and_format_mimic_data:147 | Loading MIMIC-III data files
2025-10-09 05:12:35 | DEBUG    | load_and_format_mimic_data:148 | Patients: data_files/PATIENTS.csv
2025-10-09 05:12:35 | DEBUG    | load_and_format_mimic_data:149 | Admissions: data_files/ADMISSIONS.csv
2025-10-09 05:12:35 | DEBUG    | load_and_format_mimic_data:150 | Diagnoses: data_files/DIAGNOSES_ICD.csv
2025-10-09 05:12:35 | INFO     | load_and_format_mimic_data:155 | Loaded 46520 patients
2025-10-09 05:12:35 | INFO     | load_and_format_mimic_data:158 | Loaded 58976 admissions
2025-10-09 05:12:35 | INFO     | load_and_format_mimic_data:161 | Loaded 651047 diagnosis records
2025-10-09 05:12:35 | INFO     | load_and_format_mimic_data:219 | Data processing complete. Formatting sequences...
2025-10-09 05:12:38 | INFO     | load_and_format_mimic_data:258 | Sequence formatting complete. Generated 3000 patient sequences
2025-10-09 05:12:38 | DEBUG    | load_and_format_mimic_data:262 | Sample sequence: 0 ASIAN M <demo> <v> V3001 V053 V290 <\v> <END>...
2025-10-09 05:12:38 | INFO     | load_and_format_mimic_data:267 | Average visits per patient: 1.27
2025-10-09 05:12:38 | INFO     | load_and_format_mimic_data:268 | Average tokens per sequence: 19.69
2025-10-09 05:12:38 | INFO     | <module>:622 | Sample patient sequences:
2025-10-09 05:12:38 | INFO     | <module>:624 | Sample 1: 0 WHITE M <demo> <v> V3001 V502 7660 V293 V053 <\v> <END>...
2025-10-09 05:12:38 | INFO     | <module>:624 | Sample 2: 0 WHITE M <demo> <v> V3000 76527 76518 77081 V502 V290 V017 76072 V053 <\v> <END>...
2025-10-09 05:12:38 | INFO     | <module>:624 | Sample 3: 57 UNKNOWN/NOT SPECIFIED F <demo> <v> 41041 41401 3051 V707 <\v> <END>...
2025-10-09 05:12:38 | INFO     | <module>:624 | Sample 4: 64 WHITE M <demo> <v> 41401 41041 42820 4280 42731 <\v> <END>...
2025-10-09 05:12:38 | INFO     | <module>:624 | Sample 5: 53 WHITE M <demo> <v> 41401 2720 <\v> <END>...
2025-10-09 05:12:38 | DEBUG    | __init__:294 | First sequence length: 24 tokens
2025-10-09 05:12:38 | DEBUG    | __init__:295 | Pad token ID: 1
2025-10-09 05:12:38 | INFO     | <module>:628 | Created dataset with 3000 samples, 188 batches
2025-10-09 05:12:38 | INFO     | <module>:639 | Optimizer: AdamW with lr=0.0002
2025-10-09 05:12:38 | INFO     | <module>:640 | Scheduler: linear with 0 warmup steps
2025-10-09 05:12:38 | INFO     | train_model:351 | Starting model training for 30 epochs
2025-10-09 05:12:38 | INFO     | train_model:352 | Training steps: 5640
2025-10-09 05:12:38 | INFO     | train_model:353 | Device: cuda
2025-10-09 05:12:38 | DEBUG    | train_model:372 | First batch input_ids shape: torch.Size([16, 256])
2025-10-09 05:12:38 | DEBUG    | train_model:373 | First batch labels shape: torch.Size([16, 256])
2025-10-09 05:12:38 | DEBUG    | train_model:374 | First batch attention_mask shape: torch.Size([16, 256])
2025-10-09 05:12:38 | DEBUG    | train_model:375 | Initial loss: 2.3464
2025-10-09 05:12:38 | DEBUG    | train_model:382 | Special tokens in first batch: {'pad': 3298, 'masked_labels': 3298}
2025-10-09 05:13:25 | INFO     | train_model:401 | Epoch 1/30 completed | Avg Loss: 0.4940
2025-10-09 05:14:12 | INFO     | train_model:401 | Epoch 2/30 completed | Avg Loss: 0.0662
2025-10-09 05:14:58 | INFO     | train_model:401 | Epoch 3/30 completed | Avg Loss: 0.0157
2025-10-09 05:15:45 | INFO     | train_model:401 | Epoch 4/30 completed | Avg Loss: 0.0144
2025-10-09 05:16:31 | INFO     | train_model:401 | Epoch 5/30 completed | Avg Loss: 0.0141
2025-10-09 05:17:18 | INFO     | train_model:401 | Epoch 6/30 completed | Avg Loss: 0.0515
2025-10-09 05:18:04 | INFO     | train_model:401 | Epoch 7/30 completed | Avg Loss: 0.0496
2025-10-09 05:18:51 | INFO     | train_model:401 | Epoch 8/30 completed | Avg Loss: 0.0174
2025-10-09 05:19:37 | INFO     | train_model:401 | Epoch 9/30 completed | Avg Loss: 0.0134
2025-10-09 05:20:24 | INFO     | train_model:401 | Epoch 10/30 completed | Avg Loss: 0.0100
2025-10-09 05:21:10 | INFO     | train_model:401 | Epoch 11/30 completed | Avg Loss: 0.0049
2025-10-09 05:21:57 | INFO     | train_model:401 | Epoch 12/30 completed | Avg Loss: 0.0087
2025-10-09 05:22:44 | INFO     | train_model:401 | Epoch 13/30 completed | Avg Loss: 0.0042
2025-10-09 05:23:30 | INFO     | train_model:401 | Epoch 14/30 completed | Avg Loss: 0.0040
2025-10-09 05:24:17 | INFO     | train_model:401 | Epoch 15/30 completed | Avg Loss: 0.0044
2025-10-09 05:25:03 | INFO     | train_model:401 | Epoch 16/30 completed | Avg Loss: 0.0038
2025-10-09 05:25:50 | INFO     | train_model:401 | Epoch 17/30 completed | Avg Loss: 0.0017
2025-10-09 05:26:36 | INFO     | train_model:401 | Epoch 18/30 completed | Avg Loss: 0.0036
2025-10-09 05:27:23 | INFO     | train_model:401 | Epoch 19/30 completed | Avg Loss: 0.0026
2025-10-09 05:28:09 | INFO     | train_model:401 | Epoch 20/30 completed | Avg Loss: 0.0033
2025-10-09 05:28:56 | INFO     | train_model:401 | Epoch 21/30 completed | Avg Loss: 0.0019
2025-10-09 05:29:42 | INFO     | train_model:401 | Epoch 22/30 completed | Avg Loss: 0.0010
2025-10-09 05:30:29 | INFO     | train_model:401 | Epoch 23/30 completed | Avg Loss: 0.0016
2025-10-09 05:31:16 | INFO     | train_model:401 | Epoch 24/30 completed | Avg Loss: 0.0011
2025-10-09 05:32:02 | INFO     | train_model:401 | Epoch 25/30 completed | Avg Loss: 0.0011
2025-10-09 05:32:49 | INFO     | train_model:401 | Epoch 26/30 completed | Avg Loss: 0.0009
2025-10-09 05:33:35 | INFO     | train_model:401 | Epoch 27/30 completed | Avg Loss: 0.0007
2025-10-09 05:34:22 | INFO     | train_model:401 | Epoch 28/30 completed | Avg Loss: 0.0005
2025-10-09 05:35:08 | INFO     | train_model:401 | Epoch 29/30 completed | Avg Loss: 0.0003
2025-10-09 05:35:55 | INFO     | train_model:401 | Epoch 30/30 completed | Avg Loss: 0.0009
2025-10-09 05:35:55 | INFO     | train_model:403 | Training complete
2025-10-09 05:35:55 | INFO     | train_model:404 | Final average loss: 0.0009
2025-10-09 05:35:55 | DEBUG    | train_model:405 | Loss history: [0.49395439482511994, 0.06620844813593801, 0.015725943756517657, 0.014421258852730426, 0.014077030052771505, 0.05145406712000159, 0.04955131220668455, 0.01738250330666407, 0.013424035937938977, 0.01004293711570852, 0.004889466533603944, 0.008654789892851964, 0.0042302186947710384, 0.003994215776479093, 0.00442660027603895, 0.0038499499783319286, 0.0016813976069781657, 0.0035517235310374203, 0.002610668714817408, 0.0033314238206274124, 0.001912123973446061, 0.0009741925642880774, 0.0015983773045399117, 0.0010551919708729094, 0.001098145650303195, 0.0008518369960604995, 0.0007427239839052299, 0.0005102874279145908, 0.00033456192132941026, 0.000876032018329576]
2025-10-09 05:35:55 | INFO     | <module>:654 | === Generating synthetic patient data ===
2025-10-09 05:35:55 | INFO     | <module>:663 | 
--- Sample 1/5 ---
2025-10-09 05:35:55 | INFO     | generate_patient_sequence:443 | Generating sequence for prompt: '65 UNKNOWN/NOT SPECIFIED M <demo>'
2025-10-09 05:35:55 | DEBUG    | generate_patient_sequence:447 | Prompt token IDs: [0, 3506, 2604, 47300, 73, 37049, 44921, 36482, 256, 28696, 12789, 139, 15698, 2]
2025-10-09 05:35:55 | DEBUG    | generate_patient_sequence:448 | Prompt tokens: ['<s>', '65', ' UN', 'KNOWN', '/', 'NOT', ' SPEC', 'IFIED', ' M', ' <', 'dem', 'o', '>', '</s>']
2025-10-09 05:35:55 | DEBUG    | generate_patient_sequence:457 | Special token IDs - <v>: 50265, <\v>: 50266, <END>: 50267, PAD: 1, EOS: 2
2025-10-09 05:35:55 | DEBUG    | generate_patient_sequence:464 | Initial decoder input (with forced <v>): [0, 3506, 2604, 47300, 73, 37049, 44921, 36482, 256, 28696, 12789, 139, 15698, 2, 50265]
2025-10-09 05:35:55 | DEBUG    | generate_patient_sequence:478 | After prompt, probability of <v>: 0.000072
2025-10-09 05:35:55 | DEBUG    | generate_patient_sequence:479 | After prompt, probability of <END>: 0.000016
2025-10-09 05:35:55 | DEBUG    | generate_patient_sequence:480 | After prompt, probability of PAD: 0.000000
2025-10-09 05:35:55 | DEBUG    | generate_patient_sequence:481 | After prompt, probability of EOS: 0.052638
2025-10-09 05:35:55 | DEBUG    | generate_patient_sequence:485 | Top 20 next token predictions after prompt:
2025-10-09 05:35:55 | DEBUG    | generate_patient_sequence:503 |   Rank 1: 65                   | Prob: 0.920153 | ID: 3506
2025-10-09 05:35:55 | DEBUG    | generate_patient_sequence:503 |   Rank 2: <EOS>                | Prob: 0.052638 | ID: 2
2025-10-09 05:35:55 | DEBUG    | generate_patient_sequence:503 |   Rank 3: dem                  | Prob: 0.002537 | ID: 12789
2025-10-09 05:35:55 | DEBUG    | generate_patient_sequence:503 |   Rank 4: 62                   | Prob: 0.001068 | ID: 5379
2025-10-09 05:35:55 | DEBUG    | generate_patient_sequence:503 |   Rank 5:  <                   | Prob: 0.000919 | ID: 28696
2025-10-09 05:35:55 | DEBUG    | generate_patient_sequence:503 |   Rank 6: 45                   | Prob: 0.000893 | ID: 1898
2025-10-09 05:35:55 | DEBUG    | generate_patient_sequence:503 |   Rank 7: 54                   | Prob: 0.000735 | ID: 4283
2025-10-09 05:35:55 | DEBUG    | generate_patient_sequence:503 |   Rank 8: 70                   | Prob: 0.000716 | ID: 3083
2025-10-09 05:35:55 | DEBUG    | generate_patient_sequence:503 |   Rank 9: 00                   | Prob: 0.000590 | ID: 612
2025-10-09 05:35:55 | DEBUG    | generate_patient_sequence:503 |   Rank 10: 000                  | Prob: 0.000490 | ID: 151
2025-10-09 05:35:55 | DEBUG    | generate_patient_sequence:503 |   Rank 11: 55                   | Prob: 0.000462 | ID: 3118
2025-10-09 05:35:55 | DEBUG    | generate_patient_sequence:503 |   Rank 12: 40                   | Prob: 0.000442 | ID: 1749
2025-10-09 05:35:55 | DEBUG    | generate_patient_sequence:503 |   Rank 13: 58                   | Prob: 0.000438 | ID: 4432
2025-10-09 05:35:55 | DEBUG    | generate_patient_sequence:503 |   Rank 14: 100                  | Prob: 0.000415 | ID: 1866
2025-10-09 05:35:55 | DEBUG    | generate_patient_sequence:503 |   Rank 15: 372                  | Prob: 0.000395 | ID: 34322
2025-10-09 05:35:55 | DEBUG    | generate_patient_sequence:503 |   Rank 16: 240                  | Prob: 0.000386 | ID: 18847
2025-10-09 05:35:55 | DEBUG    | generate_patient_sequence:503 |   Rank 17: 38                   | Prob: 0.000384 | ID: 3170
2025-10-09 05:35:55 | DEBUG    | generate_patient_sequence:503 |   Rank 18: 290                  | Prob: 0.000368 | ID: 24675
2025-10-09 05:35:55 | DEBUG    | generate_patient_sequence:503 |   Rank 19: 650                  | Prob: 0.000354 | ID: 16316
2025-10-09 05:35:55 | DEBUG    | generate_patient_sequence:503 |   Rank 20: 0000                 | Prob: 0.000338 | ID: 14200
2025-10-09 05:35:55 | INFO     | generate_patient_sequence:507 | Starting generation with temp=1.5, top_k=100, max_length=256
2025-10-09 05:35:55 | DEBUG    | generate_patient_sequence:520 | Generated token IDs: [2, 0, 3506, 2604, 47300, 73, 37049, 44921, 36482, 256, 28696, 12789, 139, 15698, 2, 50265, 2, 3506, 2604, 36570, 73, 37049, 2604, 47300, 15698, 1437, 50265, 2, 2, 4156, 2, 2, 4283, 1437, 50266, 1437, 50267]
2025-10-09 05:35:55 | DEBUG    | generate_patient_sequence:521 | Generated length: 37 tokens
2025-10-09 05:35:55 | INFO     | generate_patient_sequence:529 | Generated token counts - <v>: 2, <\v>: 1, <END>: 1
2025-10-09 05:35:55 | DEBUG    | generate_patient_sequence:537 | Raw generated sequence: </s><s>65 UNKNOWN/NOT SPECIFIED M <demo></s> <v> </s>65 UNRIC/NOT UNKNOWN>  <v> </s></s>59</s></s>54  <\v>   <END>
2025-10-09 05:35:55 | INFO     | generate_patient_sequence:540 | Generated sequence (clean): 65 UNKNOWN/NOT SPECIFIED M <demo>65 UNRIC/NOT UNKNOWN> 5954  
2025-10-09 05:35:55 | INFO     | <module>:663 | 
--- Sample 2/5 ---
2025-10-09 05:35:55 | INFO     | generate_patient_sequence:443 | Generating sequence for prompt: '41 HISPANIC OR LATINO M <demo>'
2025-10-09 05:35:55 | DEBUG    | generate_patient_sequence:447 | Prompt token IDs: [0, 4006, 37350, 510, 1889, 2371, 6532, 21455, 30535, 256, 28696, 12789, 139, 15698, 2]
2025-10-09 05:35:55 | DEBUG    | generate_patient_sequence:448 | Prompt tokens: ['<s>', '41', ' HIS', 'P', 'AN', 'IC', ' OR', ' LAT', 'INO', ' M', ' <', 'dem', 'o', '>', '</s>']
2025-10-09 05:35:55 | DEBUG    | generate_patient_sequence:457 | Special token IDs - <v>: 50265, <\v>: 50266, <END>: 50267, PAD: 1, EOS: 2
2025-10-09 05:35:55 | DEBUG    | generate_patient_sequence:464 | Initial decoder input (with forced <v>): [0, 4006, 37350, 510, 1889, 2371, 6532, 21455, 30535, 256, 28696, 12789, 139, 15698, 2, 50265]
2025-10-09 05:35:55 | DEBUG    | generate_patient_sequence:478 | After prompt, probability of <v>: 0.018428
2025-10-09 05:35:55 | DEBUG    | generate_patient_sequence:479 | After prompt, probability of <END>: 0.000950
2025-10-09 05:35:55 | DEBUG    | generate_patient_sequence:480 | After prompt, probability of PAD: 0.000000
2025-10-09 05:35:55 | DEBUG    | generate_patient_sequence:481 | After prompt, probability of EOS: 0.284132
2025-10-09 05:35:55 | DEBUG    | generate_patient_sequence:485 | Top 20 next token predictions after prompt:
2025-10-09 05:35:55 | DEBUG    | generate_patient_sequence:503 |   Rank 1: <EOS>                | Prob: 0.284132 | ID: 2
2025-10-09 05:35:55 | DEBUG    | generate_patient_sequence:503 |   Rank 2:  LAT                 | Prob: 0.185437 | ID: 21455
2025-10-09 05:35:55 | DEBUG    | generate_patient_sequence:503 |   Rank 3: 111                  | Prob: 0.034461 | ID: 17500
2025-10-09 05:35:55 | DEBUG    | generate_patient_sequence:503 |   Rank 4:  HIS                 | Prob: 0.025935 | ID: 37350
2025-10-09 05:35:55 | DEBUG    | generate_patient_sequence:503 |   Rank 5: 11                   | Prob: 0.023191 | ID: 1225
2025-10-09 05:35:55 | DEBUG    | generate_patient_sequence:503 |   Rank 6: <v>                  | Prob: 0.018428 | ID: 50265
2025-10-09 05:35:55 | DEBUG    | generate_patient_sequence:503 |   Rank 7: 163                  | Prob: 0.017181 | ID: 29425
2025-10-09 05:35:55 | DEBUG    | generate_patient_sequence:503 |   Rank 8: 47                   | Prob: 0.014818 | ID: 3706
2025-10-09 05:35:55 | DEBUG    | generate_patient_sequence:503 |   Rank 9: 70                   | Prob: 0.012568 | ID: 3083
2025-10-09 05:35:55 | DEBUG    | generate_patient_sequence:503 |   Rank 10: 001                  | Prob: 0.011957 | ID: 19089
2025-10-09 05:35:55 | DEBUG    | generate_patient_sequence:503 |   Rank 11: 71                   | Prob: 0.008978 | ID: 5339
2025-10-09 05:35:55 | DEBUG    | generate_patient_sequence:503 |   Rank 12: 002                  | Prob: 0.007981 | ID: 19130
2025-10-09 05:35:55 | DEBUG    | generate_patient_sequence:503 |   Rank 13: 373                  | Prob: 0.007736 | ID: 34099
2025-10-09 05:35:55 | DEBUG    | generate_patient_sequence:503 |   Rank 14: 85                   | Prob: 0.007427 | ID: 4531
2025-10-09 05:35:55 | DEBUG    | generate_patient_sequence:503 |   Rank 15: 100                  | Prob: 0.007310 | ID: 1866
2025-10-09 05:35:55 | DEBUG    | generate_patient_sequence:503 |   Rank 16:  <                   | Prob: 0.007175 | ID: 28696
2025-10-09 05:35:55 | DEBUG    | generate_patient_sequence:503 |   Rank 17: 010                  | Prob: 0.007104 | ID: 30583
2025-10-09 05:35:55 | DEBUG    | generate_patient_sequence:503 |   Rank 18: 37                   | Prob: 0.006695 | ID: 3272
2025-10-09 05:35:55 | DEBUG    | generate_patient_sequence:503 |   Rank 19: 789                  | Prob: 0.006372 | ID: 39413
2025-10-09 05:35:55 | DEBUG    | generate_patient_sequence:503 |   Rank 20: 331                  | Prob: 0.005867 | ID: 34071
2025-10-09 05:35:55 | INFO     | generate_patient_sequence:507 | Starting generation with temp=1.5, top_k=100, max_length=256
2025-10-09 05:35:55 | DEBUG    | generate_patient_sequence:520 | Generated token IDs: [2, 0, 4006, 37350, 510, 1889, 2371, 6532, 21455, 30535, 256, 28696, 12789, 139, 15698, 2, 50265, 2, 1225, 37350, 510, 36570, 6532, 21455, 2371, 256, 28696, 24658, 139, 15698, 1437, 50265, 2, 2, 2, 2663, 321, 4283, 1437, 50266, 1437, 50267]
2025-10-09 05:35:55 | DEBUG    | generate_patient_sequence:521 | Generated length: 42 tokens
2025-10-09 05:35:55 | INFO     | generate_patient_sequence:529 | Generated token counts - <v>: 2, <\v>: 1, <END>: 1
2025-10-09 05:35:55 | DEBUG    | generate_patient_sequence:537 | Raw generated sequence: </s><s>41 HISPANIC OR LATINO M <demo></s> <v> </s>11 HISPRIC OR LATIC M <Demo>  <v> </s></s></s>01 054  <\v>   <END>
2025-10-09 05:35:55 | INFO     | generate_patient_sequence:540 | Generated sequence (clean): 41 HISPANIC OR LATINO M <demo>11 HISPRIC OR LATIC M <Demo> 01 054  
2025-10-09 05:35:55 | INFO     | <module>:663 | 
--- Sample 3/5 ---
2025-10-09 05:35:55 | INFO     | generate_patient_sequence:443 | Generating sequence for prompt: '68 ASIAN F <demo>'
2025-10-09 05:35:55 | DEBUG    | generate_patient_sequence:447 | Prompt token IDs: [0, 4671, 6015, 10296, 274, 28696, 12789, 139, 15698, 2]
2025-10-09 05:35:55 | DEBUG    | generate_patient_sequence:448 | Prompt tokens: ['<s>', '68', ' AS', 'IAN', ' F', ' <', 'dem', 'o', '>', '</s>']
2025-10-09 05:35:55 | DEBUG    | generate_patient_sequence:457 | Special token IDs - <v>: 50265, <\v>: 50266, <END>: 50267, PAD: 1, EOS: 2
2025-10-09 05:35:55 | DEBUG    | generate_patient_sequence:464 | Initial decoder input (with forced <v>): [0, 4671, 6015, 10296, 274, 28696, 12789, 139, 15698, 2, 50265]
2025-10-09 05:35:56 | DEBUG    | generate_patient_sequence:478 | After prompt, probability of <v>: 0.000021
2025-10-09 05:35:56 | DEBUG    | generate_patient_sequence:479 | After prompt, probability of <END>: 0.000007
2025-10-09 05:35:56 | DEBUG    | generate_patient_sequence:480 | After prompt, probability of PAD: 0.000000
2025-10-09 05:35:56 | DEBUG    | generate_patient_sequence:481 | After prompt, probability of EOS: 0.003705
2025-10-09 05:35:56 | DEBUG    | generate_patient_sequence:485 | Top 20 next token predictions after prompt:
2025-10-09 05:35:56 | DEBUG    | generate_patient_sequence:503 |   Rank 1: 68                   | Prob: 0.992978 | ID: 4671
2025-10-09 05:35:56 | DEBUG    | generate_patient_sequence:503 |   Rank 2: <EOS>                | Prob: 0.003705 | ID: 2
2025-10-09 05:35:56 | DEBUG    | generate_patient_sequence:503 |   Rank 3:  68                  | Prob: 0.000733 | ID: 5595
2025-10-09 05:35:56 | DEBUG    | generate_patient_sequence:503 |   Rank 4: 38                   | Prob: 0.000382 | ID: 3170
2025-10-09 05:35:56 | DEBUG    | generate_patient_sequence:503 |   Rank 5: 54                   | Prob: 0.000259 | ID: 4283
2025-10-09 05:35:56 | DEBUG    | generate_patient_sequence:503 |   Rank 6: 0                    | Prob: 0.000202 | ID: 288
2025-10-09 05:35:56 | DEBUG    | generate_patient_sequence:503 |   Rank 7: 58                   | Prob: 0.000090 | ID: 4432
2025-10-09 05:35:56 | DEBUG    | generate_patient_sequence:503 |   Rank 8: 652                  | Prob: 0.000072 | ID: 38413
2025-10-09 05:35:56 | DEBUG    | generate_patient_sequence:503 |   Rank 9: 70                   | Prob: 0.000064 | ID: 3083
2025-10-09 05:35:56 | DEBUG    | generate_patient_sequence:503 |   Rank 10: 26                   | Prob: 0.000054 | ID: 2481
2025-10-09 05:35:56 | DEBUG    | generate_patient_sequence:503 |   Rank 11: 498                  | Prob: 0.000051 | ID: 37412
2025-10-09 05:35:56 | DEBUG    | generate_patient_sequence:503 |   Rank 12: 56                   | Prob: 0.000047 | ID: 4419
2025-10-09 05:35:56 | DEBUG    | generate_patient_sequence:503 |   Rank 13: 248                  | Prob: 0.000046 | ID: 28654
2025-10-09 05:35:56 | DEBUG    | generate_patient_sequence:503 |   Rank 14: 002                  | Prob: 0.000043 | ID: 19130
2025-10-09 05:35:56 | DEBUG    | generate_patient_sequence:503 |   Rank 15: 42                   | Prob: 0.000043 | ID: 3714
2025-10-09 05:35:56 | DEBUG    | generate_patient_sequence:503 |   Rank 16: 47                   | Prob: 0.000039 | ID: 3706
2025-10-09 05:35:56 | DEBUG    | generate_patient_sequence:503 |   Rank 17: 62                   | Prob: 0.000037 | ID: 5379
2025-10-09 05:35:56 | DEBUG    | generate_patient_sequence:503 |   Rank 18: 52                   | Prob: 0.000032 | ID: 4429
2025-10-09 05:35:56 | DEBUG    | generate_patient_sequence:503 |   Rank 19: 98                   | Prob: 0.000030 | ID: 5208
2025-10-09 05:35:56 | DEBUG    | generate_patient_sequence:503 |   Rank 20: 71                   | Prob: 0.000029 | ID: 5339
2025-10-09 05:35:56 | INFO     | generate_patient_sequence:507 | Starting generation with temp=1.5, top_k=100, max_length=256
2025-10-09 05:35:56 | DEBUG    | generate_patient_sequence:520 | Generated token IDs: [2, 0, 4671, 6015, 10296, 274, 28696, 12789, 139, 15698, 2, 50265, 2, 4432, 139, 15698, 1437, 50267]
2025-10-09 05:35:56 | DEBUG    | generate_patient_sequence:521 | Generated length: 18 tokens
2025-10-09 05:35:56 | INFO     | generate_patient_sequence:529 | Generated token counts - <v>: 1, <\v>: 0, <END>: 1
2025-10-09 05:35:56 | DEBUG    | generate_patient_sequence:537 | Raw generated sequence: </s><s>68 ASIAN F <demo></s> <v> </s>58o>  <END>
2025-10-09 05:35:56 | INFO     | generate_patient_sequence:540 | Generated sequence (clean): 68 ASIAN F <demo>58o> 
2025-10-09 05:35:56 | INFO     | <module>:663 | 
--- Sample 4/5 ---
2025-10-09 05:35:56 | INFO     | generate_patient_sequence:443 | Generating sequence for prompt: '72 BLACK F <demo>'
2025-10-09 05:35:56 | DEBUG    | generate_patient_sequence:447 | Prompt token IDs: [0, 4956, 34101, 274, 28696, 12789, 139, 15698, 2]
2025-10-09 05:35:56 | DEBUG    | generate_patient_sequence:448 | Prompt tokens: ['<s>', '72', ' BLACK', ' F', ' <', 'dem', 'o', '>', '</s>']
2025-10-09 05:35:56 | DEBUG    | generate_patient_sequence:457 | Special token IDs - <v>: 50265, <\v>: 50266, <END>: 50267, PAD: 1, EOS: 2
2025-10-09 05:35:56 | DEBUG    | generate_patient_sequence:464 | Initial decoder input (with forced <v>): [0, 4956, 34101, 274, 28696, 12789, 139, 15698, 2, 50265]
2025-10-09 05:35:56 | DEBUG    | generate_patient_sequence:478 | After prompt, probability of <v>: 0.000000
2025-10-09 05:35:56 | DEBUG    | generate_patient_sequence:479 | After prompt, probability of <END>: 0.000000
2025-10-09 05:35:56 | DEBUG    | generate_patient_sequence:480 | After prompt, probability of PAD: 0.000000
2025-10-09 05:35:56 | DEBUG    | generate_patient_sequence:481 | After prompt, probability of EOS: 0.000017
2025-10-09 05:35:56 | DEBUG    | generate_patient_sequence:485 | Top 20 next token predictions after prompt:
2025-10-09 05:35:56 | DEBUG    | generate_patient_sequence:503 |   Rank 1: 72                   | Prob: 0.999736 | ID: 4956
2025-10-09 05:35:56 | DEBUG    | generate_patient_sequence:503 |   Rank 2:  72                  | Prob: 0.000029 | ID: 4801
2025-10-09 05:35:56 | DEBUG    | generate_patient_sequence:503 |   Rank 3: 2                    | Prob: 0.000019 | ID: 176
2025-10-09 05:35:56 | DEBUG    | generate_patient_sequence:503 |   Rank 4: <EOS>                | Prob: 0.000017 | ID: 2
2025-10-09 05:35:56 | DEBUG    | generate_patient_sequence:503 |   Rank 5: 62                   | Prob: 0.000013 | ID: 5379
2025-10-09 05:35:56 | DEBUG    | generate_patient_sequence:503 |   Rank 6: 18                   | Prob: 0.000012 | ID: 1366
2025-10-09 05:35:56 | DEBUG    | generate_patient_sequence:503 |   Rank 7: 772                  | Prob: 0.000010 | ID: 38949
2025-10-09 05:35:56 | DEBUG    | generate_patient_sequence:503 |   Rank 8: 240                  | Prob: 0.000009 | ID: 18847
2025-10-09 05:35:56 | DEBUG    | generate_patient_sequence:503 |   Rank 9: 73                   | Prob: 0.000008 | ID: 5352
2025-10-09 05:35:56 | DEBUG    | generate_patient_sequence:503 |   Rank 10: 71                   | Prob: 0.000008 | ID: 5339
2025-10-09 05:35:56 | DEBUG    | generate_patient_sequence:503 |   Rank 11: 42                   | Prob: 0.000006 | ID: 3714
2025-10-09 05:35:56 | DEBUG    | generate_patient_sequence:503 |   Rank 12: 178                  | Prob: 0.000006 | ID: 28799
2025-10-09 05:35:56 | DEBUG    | generate_patient_sequence:503 |   Rank 13: 57                   | Prob: 0.000005 | ID: 4390
2025-10-09 05:35:56 | DEBUG    | generate_patient_sequence:503 |   Rank 14:  42                  | Prob: 0.000005 | ID: 3330
2025-10-09 05:35:56 | DEBUG    | generate_patient_sequence:503 |   Rank 15: 48                   | Prob: 0.000005 | ID: 3818
2025-10-09 05:35:56 | DEBUG    | generate_patient_sequence:503 |   Rank 16:  1972                | Prob: 0.000003 | ID: 15002
2025-10-09 05:35:56 | DEBUG    | generate_patient_sequence:503 |   Rank 17: 248                  | Prob: 0.000003 | ID: 28654
2025-10-09 05:35:56 | DEBUG    | generate_patient_sequence:503 |   Rank 18: 70                   | Prob: 0.000003 | ID: 3083
2025-10-09 05:35:56 | DEBUG    | generate_patient_sequence:503 |   Rank 19: 65                   | Prob: 0.000003 | ID: 3506
2025-10-09 05:35:56 | DEBUG    | generate_patient_sequence:503 |   Rank 20: 02                   | Prob: 0.000003 | ID: 4197
2025-10-09 05:35:56 | INFO     | generate_patient_sequence:507 | Starting generation with temp=1.5, top_k=100, max_length=256
2025-10-09 05:35:56 | DEBUG    | generate_patient_sequence:520 | Generated token IDs: [2, 0, 4956, 34101, 274, 28696, 12789, 139, 15698, 2, 50265, 2, 4956, 34101, 256, 28696, 12789, 366, 15698, 1437, 50265, 2, 2, 2, 288, 3079, 2, 2, 2371, 14722, 17500, 274, 15171, 3079, 1437, 50266, 1437, 50267]
2025-10-09 05:35:56 | DEBUG    | generate_patient_sequence:521 | Generated length: 38 tokens
2025-10-09 05:35:56 | INFO     | generate_patient_sequence:529 | Generated token counts - <v>: 2, <\v>: 1, <END>: 1
2025-10-09 05:35:56 | DEBUG    | generate_patient_sequence:537 | Raw generated sequence: </s><s>72 BLACK F <demo></s> <v> </s>72 BLACK M <demos>  <v> </s></s></s>034</s></s>IC 04111 F 0334  <\v>   <END>
2025-10-09 05:35:56 | INFO     | generate_patient_sequence:540 | Generated sequence (clean): 72 BLACK F <demo>72 BLACK M <demos> 034IC 04111 F 0334  
2025-10-09 05:35:56 | INFO     | <module>:663 | 
--- Sample 5/5 ---
2025-10-09 05:35:56 | INFO     | generate_patient_sequence:443 | Generating sequence for prompt: '80 HISPANIC OR LATINO F <demo>'
2025-10-09 05:35:56 | DEBUG    | generate_patient_sequence:447 | Prompt token IDs: [0, 2940, 37350, 510, 1889, 2371, 6532, 21455, 30535, 274, 28696, 12789, 139, 15698, 2]
2025-10-09 05:35:56 | DEBUG    | generate_patient_sequence:448 | Prompt tokens: ['<s>', '80', ' HIS', 'P', 'AN', 'IC', ' OR', ' LAT', 'INO', ' F', ' <', 'dem', 'o', '>', '</s>']
2025-10-09 05:35:56 | DEBUG    | generate_patient_sequence:457 | Special token IDs - <v>: 50265, <\v>: 50266, <END>: 50267, PAD: 1, EOS: 2
2025-10-09 05:35:56 | DEBUG    | generate_patient_sequence:464 | Initial decoder input (with forced <v>): [0, 2940, 37350, 510, 1889, 2371, 6532, 21455, 30535, 274, 28696, 12789, 139, 15698, 2, 50265]
2025-10-09 05:35:56 | DEBUG    | generate_patient_sequence:478 | After prompt, probability of <v>: 0.009655
2025-10-09 05:35:56 | DEBUG    | generate_patient_sequence:479 | After prompt, probability of <END>: 0.000853
2025-10-09 05:35:56 | DEBUG    | generate_patient_sequence:480 | After prompt, probability of PAD: 0.000000
2025-10-09 05:35:56 | DEBUG    | generate_patient_sequence:481 | After prompt, probability of EOS: 0.815851
2025-10-09 05:35:56 | DEBUG    | generate_patient_sequence:485 | Top 20 next token predictions after prompt:
2025-10-09 05:35:56 | DEBUG    | generate_patient_sequence:503 |   Rank 1: <EOS>                | Prob: 0.815851 | ID: 2
2025-10-09 05:35:56 | DEBUG    | generate_patient_sequence:503 |   Rank 2:  LAT                 | Prob: 0.026062 | ID: 21455
2025-10-09 05:35:56 | DEBUG    | generate_patient_sequence:503 |   Rank 3: 80                   | Prob: 0.015859 | ID: 2940
2025-10-09 05:35:56 | DEBUG    | generate_patient_sequence:503 |   Rank 4: <v>                  | Prob: 0.009655 | ID: 50265
2025-10-09 05:35:56 | DEBUG    | generate_patient_sequence:503 |   Rank 5: 70                   | Prob: 0.004440 | ID: 3083
2025-10-09 05:35:56 | DEBUG    | generate_patient_sequence:503 |   Rank 6: 11                   | Prob: 0.004030 | ID: 1225
2025-10-09 05:35:56 | DEBUG    | generate_patient_sequence:503 |   Rank 7: 74                   | Prob: 0.003262 | ID: 5243
2025-10-09 05:35:56 | DEBUG    | generate_patient_sequence:503 |   Rank 8: 139                  | Prob: 0.002769 | ID: 25488
2025-10-09 05:35:56 | DEBUG    | generate_patient_sequence:503 |   Rank 9: 100                  | Prob: 0.002741 | ID: 1866
2025-10-09 05:35:56 | DEBUG    | generate_patient_sequence:503 |   Rank 10:  311                 | Prob: 0.002720 | ID: 33067
2025-10-09 05:35:56 | DEBUG    | generate_patient_sequence:503 |   Rank 11: 002                  | Prob: 0.002632 | ID: 19130
2025-10-09 05:35:56 | DEBUG    | generate_patient_sequence:503 |   Rank 12: IC                   | Prob: 0.002287 | ID: 2371
2025-10-09 05:35:56 | DEBUG    | generate_patient_sequence:503 |   Rank 13: 372                  | Prob: 0.002287 | ID: 34322
2025-10-09 05:35:56 | DEBUG    | generate_patient_sequence:503 |   Rank 14: 163                  | Prob: 0.002286 | ID: 29425
2025-10-09 05:35:56 | DEBUG    | generate_patient_sequence:503 |   Rank 15: L                    | Prob: 0.002190 | ID: 574
2025-10-09 05:35:56 | DEBUG    | generate_patient_sequence:503 |   Rank 16: 240                  | Prob: 0.002054 | ID: 18847
2025-10-09 05:35:56 | DEBUG    | generate_patient_sequence:503 |   Rank 17: 75                   | Prob: 0.001866 | ID: 2545
2025-10-09 05:35:56 | DEBUG    | generate_patient_sequence:503 |   Rank 18: 262                  | Prob: 0.001862 | ID: 29630
2025-10-09 05:35:56 | DEBUG    | generate_patient_sequence:503 |   Rank 19: RIC                  | Prob: 0.001826 | ID: 36570
2025-10-09 05:35:56 | DEBUG    | generate_patient_sequence:503 |   Rank 20: 40                   | Prob: 0.001765 | ID: 1749
2025-10-09 05:35:56 | INFO     | generate_patient_sequence:507 | Starting generation with temp=1.5, top_k=100, max_length=256
2025-10-09 05:35:56 | DEBUG    | generate_patient_sequence:520 | Generated token IDs: [2, 0, 2940, 37350, 510, 1889, 2371, 6532, 21455, 30535, 274, 28696, 12789, 139, 15698, 2, 50265, 2, 2, 19130, 15698, 1437, 50267]
2025-10-09 05:35:56 | DEBUG    | generate_patient_sequence:521 | Generated length: 23 tokens
2025-10-09 05:35:56 | INFO     | generate_patient_sequence:529 | Generated token counts - <v>: 1, <\v>: 0, <END>: 1
2025-10-09 05:35:56 | DEBUG    | generate_patient_sequence:537 | Raw generated sequence: </s><s>80 HISPANIC OR LATINO F <demo></s> <v> </s></s>002>  <END>
2025-10-09 05:35:56 | INFO     | generate_patient_sequence:540 | Generated sequence (clean): 80 HISPANIC OR LATINO F <demo>002> 
2025-10-09 05:35:56 | INFO     | <module>:677 | === Training and generation complete ===
